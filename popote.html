<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Popote </title>
	<link rel="icon" href="favicon.ico" sizes="any" type="image/png">
    <link rel="icon" href="favicon.ico" type="image/svg+xml">
    <link rel="apple-touch-icon" href="favicon.ico">
    <link rel="manifest" href="site.webmanifest">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet" />
	<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500&family=Saira+Stencil+One&display=swap" rel="stylesheet">
   <style>
        /* --- 1. VARIABLES & THEME TACTICAL GLASS --- */
        :root {
            /* Couleurs de base (PC TAC) */
            --bg-body: #050505;
            --bg-glass: rgba(22, 22, 25, 0.7); 
            --bg-glass-heavy: rgba(15, 15, 20, 0.95);
            --bg-input: rgba(0, 0, 0, 0.4);
            --bg-element: rgba(255, 255, 255, 0.03); 
            --border-glass: rgba(255, 255, 255, 0.08);
            
            /* Typographie */
            --font-ui: 'Oswald', sans-serif;
            --font-data: 'JetBrains Mono', monospace;
            --font-title: 'Saira Stencil One', cursive;

            /* Couleurs Interactives */
            --accent-blue: #3b82f6;
            --accent-hover: #2563eb;
            --accent-glow: rgba(59, 130, 246, 0.3);
            --text-primary: #e0e0e0;
            --text-secondary: #94a3b8;
            
            /* Status */
            --danger-red: #ef4444; 
            --success-green: #22c55e;
            --trash-color: #64748b;
            --prozis-red: #DC3545;

            /* Espacement */
            --radius-md: 12px;
            --radius-sm: 6px;
            
            /* Compatibilit√© Popote */
            --bg-container: var(--bg-glass);
            --bg-interactive: var(--bg-input);
            --border-color: var(--border-glass);
            --revolut-btn-bg: #000000;
        }

        body.light-mode {
            --bg-body: #f1f5f9;
            --bg-glass: rgba(255, 255, 255, 0.85);
            --bg-glass-heavy: #ffffff;
            --bg-input: rgba(255, 255, 255, 0.6);
            --bg-element: rgba(0, 0, 0, 0.03);
            --border-glass: rgba(0, 0, 0, 0.1);
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --accent-blue: #0f4c9c;
            --border-color: var(--border-glass);
            --bg-container: var(--bg-glass);
            --bg-interactive: var(--bg-input);
            --trash-color: #64748b;
            --revolut-btn-bg: #121212;
        }

        /* --- 2. RESET & LAYOUT GLOBAL --- */
        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }
        html { font-size: 16px; }
        
        body {
            font-family: var(--font-ui);
            background-color: var(--bg-body);
            color: var(--text-primary);
            /* Texture tactique (Grille) */
            background-image: 
                linear-gradient(rgba(59, 130, 246, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(59, 130, 246, 0.03) 1px, transparent 1px);
            background-size: 40px 40px;
            min-height: 100vh;
            padding: 20px 10px 100px 10px; /* Padding bottom pour le dock */
            transition: background 0.3s ease;
            line-height: 1.6;
        }

        .container {
            width: 100%; max-width: 900px; margin: auto;
            background: var(--bg-glass);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border-glass);
            border-radius: var(--radius-md);
            padding: 25px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.2);
        }

        /* --- 3. TYPOGRAPHIE --- */
        h1 {
            font-family: var(--font-title);
            font-size: 2.5em;
            color: var(--accent-blue);
            text-align: center;
            text-shadow: 0 0 20px var(--accent-glow);
            letter-spacing: 2px;
            margin-bottom: 25px;
            font-weight: 400;
            text-transform: uppercase;
        }

        h2, h3, h4 { color: var(--text-primary); margin-top: 15px; }

        /* --- 4. FORMULAIRES & INPUTS --- */
        fieldset {
            border: 1px solid var(--border-glass);
            border-radius: var(--radius-sm);
            padding: 20px;
            margin-bottom: 25px;
            background: var(--bg-element);
        }
        legend {
            padding: 0 10px;
            font-size: 1.2em;
            color: var(--accent-blue);
            font-family: var(--font-title);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        input, select {
            width: 100%; background: var(--bg-input); 
            border: 1px solid var(--border-glass);
            border-radius: var(--radius-sm); 
            padding: 12px; 
            color: var(--text-primary);
            font-family: var(--font-data); 
            font-size: 1rem; 
            min-height: 48px;
            transition: all 0.2s;
            margin-bottom: 10px;
        }
        
        input:focus, select:focus {
            border-color: var(--accent-blue);
            background: rgba(0,0,0,0.6);
            box-shadow: 0 0 10px var(--accent-glow);
        }

        .item-selector label {
            display: block; margin-bottom: 5px; font-weight: bold;
            color: var(--text-secondary); font-size: 0.85em; text-transform: uppercase;
        }

        /* --- 5. ELEMENTS SPECIFIQUES POPOTE --- */
        
        /* Items de consommation */
        .conso-item {
            display: flex; justify-content: flex-start; align-items: center;
            margin-bottom: 10px; gap: 15px;
            background: var(--bg-input);
            padding: 8px; border-radius: var(--radius-sm);
            border: 1px solid var(--border-glass);
        }
        .conso-item-image {
            width: 50px; height: 50px; object-fit: cover; border-radius: 4px;
            border: 1px solid var(--border-glass);
        }
        .conso-item label {
            flex-grow: 1; font-weight: 400; font-size: 1rem;
            color: var(--text-primary); font-family: var(--font-ui);
        }
        .conso-item input {
            width: 80px; text-align: center; margin-bottom: 0;
            background: var(--bg-body); border-color: var(--border-glass);
        }

        /* Boutons d'action */
        .action-button {
            display: flex; justify-content: center; align-items: center;
            width: 100%; padding: 14px; margin-top: 15px;
            font-family: var(--font-title); font-size: 1.1em; letter-spacing: 1px;
            color: white; border: none; border-radius: var(--radius-sm);
            cursor: pointer; text-transform: uppercase; text-decoration: none;
            transition: all 0.2s;
        }
        .action-button:hover { filter: brightness(1.1); transform: translateY(-1px); }
        .action-button:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }

        /* Revolut Button */
        .action-button.revolut {
            background-color: var(--revolut-btn-bg);
            border: 1px solid var(--border-glass);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        .action-button.revolut.pulse-high {
            animation: pulse-border 1.5s infinite;
            border-color: var(--danger-red);
            color: var(--danger-red);
        }
        @keyframes pulse-border {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }

        /* Prozis Button */
        .action-button.prozis-button {
            background-color: var(--prozis-red);
            margin-top: 25px;
            box-shadow: 0 0 15px rgba(220, 53, 69, 0.3);
        }
        
        .prozis-info-box {
            background-color: var(--bg-input);
            padding: 15px; border-radius: var(--radius-sm);
            border: 1px solid var(--border-glass); margin-top: 15px;
        }
        .prozis-info-box li { margin-bottom: 5px; font-family: var(--font-data); font-size: 0.9em; }
        .prozis-info-box strong { color: var(--accent-blue); }

        /* Messages de dette */
        #dette-box {
            display: flex; align-items: center; justify-content: center;
            font-size: 1.1em; padding: 12px; border-radius: var(--radius-sm);
            margin-top: 15px; font-weight: bold;
        }
        .dette-box-correct {
            background-color: rgba(34, 197, 94, 0.2); color: var(--success-green);
            border: 1px solid var(--success-green);
        }
        .dette-box-incorrect {
            background-color: rgba(239, 68, 68, 0.2); color: var(--danger-red);
            border: 1px solid var(--danger-red);
        }
        
        .high-debt-message {
            text-align: center; margin-bottom: 15px; font-weight: bold; padding: 10px;
            border-radius: var(--radius-sm);
            background-color: rgba(239, 68, 68, 0.2);
            color: var(--danger-red);
            border: 1px solid var(--danger-red);
        }

        /* --- 6. DOCK MENU (Style PC TAC Standardis√©) --- */
        .dock-menu {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: var(--bg-glass-heavy); backdrop-filter: blur(15px);
            border: 1px solid var(--border-glass); border-radius: 30px;
            padding: 8px 15px; display: flex; align-items: center; gap: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.6); z-index: 2000;
            transition: width 0.3s, padding 0.3s;
            max-width: 90vw; width: auto; overflow-x: auto; scrollbar-width: none;
            
            /* Override old styles */
            top: auto; flex-direction: row; height: auto; opacity: 1 !important;
        }
        .dock-menu::-webkit-scrollbar { display: none; }

        .dock-menu:not(.collapsed) {
            width: auto; opacity: 1; border-radius: 30px;
        }
        .dock-menu:not(.collapsed):hover {
            background-color: var(--bg-glass-heavy); border: 1px solid var(--border-glass);
        }

        .dock-menu.collapsed { 
            width: 50px; height: 50px; padding: 0; justify-content: center; overflow: hidden; 
            border-radius: 50%; background-color: var(--bg-glass-heavy);
        }
        .dock-menu.collapsed .dock-menu-item { display: none; }
        
        /* Bouton toggle sp√©cifique */
        .dock-toggle-btn {
            background-color: transparent; color: var(--accent-blue);
            border: none; width: auto; height: auto; display: flex; align-items: center; justify-content: center;
            cursor: pointer; box-shadow: none; padding: 0;
        }
        .dock-menu:not(.collapsed) .dock-toggle-btn { display: flex; } /* Force display */
        
        .dock-menu-item {
            width: 42px; height: 42px; border-radius: 50%; flex-shrink: 0;
            display: flex; align-items: center; justify-content: center;
            color: var(--text-secondary); text-decoration: none; cursor: pointer;
            transition: all 0.2s; background: transparent; border: none; box-shadow: none;
        }
        .dock-menu-item span { font-size: 24px; }
        .dock-menu-item:hover { color: var(--text-primary); background: rgba(255,255,255,0.1); transform: none; }

        /* Ajustement des icones mat√©rielles */
        .material-icons, .material-symbols-outlined { font-size: 24px; }
        .dock-toggle-btn .material-icons { transform: rotate(-90deg); transition: transform 0.3s; }
        .dock-menu.collapsed .dock-toggle-btn .material-icons { transform: rotate(90deg); }

        /* --- FOOTER --- */
        #main-footer {
            width: 100%; text-align: center; margin-top: 2rem; padding: 1rem;
            color: var(--text-secondary); font-size: 0.75rem;
            border-top: 1px solid var(--border-glass); opacity: 0.6;
        }

        /* --- RESPONSIVE --- */
        @media (max-width: 600px) {
            .container { padding: 15px; }
            h1 { font-size: 2em; }
            .dock-menu:not(.collapsed) {
                width: 95%; padding: 5px; gap: 5px; justify-content: center; flex-wrap: wrap;
            }
            .dock-menu:not(.collapsed) .dock-menu-item { width: 45px; height: 45px; }
        }
    </style>
</head>
<body>
    <div class="dock-menu" id="dockMenu">
        <div class="dock-toggle-btn" id="dockToggleBtn">
            <span class="material-icons">arrow_left</span>
        </div>
        <a href="index.html" class="dock-menu-item home-button">
            <span class="material-icons">home</span>
        </a>
        <div class="dock-menu-item dark-mode-toggle" id="darkModeToggle">
            <span class="material-symbols-outlined" id="darkModeIcon"></span>
        </div>
    </div>

    <div class="container" id="app" style="display: none;">
        <h1>{{ siteTitle }}</h1>
        <a href="https://revolut.me/nicomhx" target="_blank" class="action-button revolut" :class="{'pulse-high': isHighDebt}" style="text-decoration: none; text-align: center; margin-bottom: 5px;"> Payer mes dettes üí∏ </a>
        <div style="text-align: center; margin-bottom: 20px; color: var(--text-secondary); font-size: 1em;">
            <p>Lors du paiement merci d'ajouter votre trigramme et la date.</p>
        </div>
        
        <div class="login-fieldsets" v-if="!isConnected">
            <fieldset>
                <legend>Acc√®s</legend>
                <div v-if="allDettes.length > 0">
                    <p style="text-align:center; font-size: 1.2em; margin-bottom: 15px;">Dette actuelle: <span :style="{ color: connectedMemberDette ? (connectedMemberDette.dette > 0 ? 'var(--danger-red-dark)' : 'var(--success-green)') : 'var(--text-primary)' }">{{ connectedMemberDette ? connectedMemberDette.dette.toFixed(2) + ' ‚Ç¨' : 'N/A' }}</span></p>
                </div>
                <div class="item-selector">
                    <label for="member-select">Nom du membre</label>
                    <select id="member-select" v-model="selectedMember">
                        <option value="">S√©lectionner un membre</option>
                        <option v-for="member in allMembers" :key="member" :value="member">{{ member }}</option>
                    </select>
                </div>
                <div class="item-selector">
                    <label for="password-input">Mot de passe</label>
                    <input type="password" id="password-input" v-model="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <button @click="validateLogin" class="action-button" :style="{'background-color': 'var(--accent-blue)'}" :disabled="loadingValidation">{{ loadingValidation ? 'Validation...' : 'Valider' }}</button>
            </fieldset>
        </div>
        
        <div id="dette-box" :class="{'dette-box-correct': validationMessage.isCorrect, 'dette-box-incorrect': !validationMessage.isCorrect}" v-if="validationMessage.text && !passwordChangeMessage.text">
            <span>{{ validationMessage.text }}</span>
        </div>

        <fieldset id="conso-fieldset" v-if="isConnected">
            <legend>Ajouter une consommation</legend>
            <div v-if="isAlertDebt" class="high-debt-message">Votre dette est √©lev√©e, veuillez penser √† la r√©gler.</div>
            <div v-if="isBlockDebt" class="high-debt-message">Votre dette est trop √©lev√©e, veuillez la r√©gler pour continuer √† consommer.</div>
            <div class="conso-item"><img src="canettes.png" class="conso-item-image"><label for="canettes">Canettes & Sucreries (0.6‚Ç¨)</label><input type="number" id="canettes" v-model.number="conso.canettes" min="0" :disabled="isBlockDebt"></div>
            <div class="conso-item"><img src="bcaa.png" class="conso-item-image"><label for="bcaa">Bcaa (1.5‚Ç¨)</label><input type="number" id="bcaa" v-model.number="conso.bcaa" min="0" :disabled="isBlockDebt"></div>
            <div class="conso-item"><img src="cookie.png" class="conso-item-image"><label for="cookie">Cookie&Barres Prozis (1.8‚Ç¨)</label><input type="number" id="cookie" v-model.number="conso.cookie" min="0" :disabled="isBlockDebt"></div>
            <div class="conso-item"><img src="boules.png" class="conso-item-image"><label for="boules">Boules&Brownies Prozis (1.5‚Ç¨)</label><input type="number" id="boules" v-model.number="conso.boules" min="0" :disabled="isBlockDebt"></div>
            <div class="conso-item"><img src="autres.png" class="conso-item-image"><label for="autres">Eau (0.4‚Ç¨)</label><input type="number" id="autres" v-model.number="conso.autres" min="0" :disabled="isBlockDebt"></div>
            <div v-if="totalConso > 0"><strong>Total √† ajouter : {{ totalConso.toFixed(2) }}‚Ç¨</strong></div>
            <button @click="submitConso" class="action-button" :style="{'background-color': 'var(--accent-blue)'}" :disabled="loadingSubmit || isBlockDebt">{{ loadingSubmit ? 'Envoi...' : 'Valider la conso' }}</button>
            <button @click="resetForm" class="action-button" :style="{'background-color': 'var(--text-secondary)'}">Fermer</button>
        </fieldset>

        <fieldset id="password-fieldset" v-if="isConnected">
            <legend>Modifier le mot de passe</legend>
            <input type="password" v-model="oldPassword" placeholder="Ancien mot de passe" style="margin-bottom: 10px;">
            <input type="password" v-model="newPassword" placeholder="Nouveau mot de passe">
            <button @click="changeUserPassword" class="action-button" :style="{'background-color': 'var(--accent-blue)'}" :disabled="loadingPasswordChange">{{ loadingPasswordChange ? 'Mise √† jour...' : 'Modifier' }}</button>
             <div id="password-change-box" v-if="passwordChangeMessage.text">{{ passwordChangeMessage.text }}</div>
        </fieldset>

        <fieldset v-if="isConnected" style="margin-top: 25px;">
            <legend>Prozis √âlite</legend>
            <button @click="toggleProzisInfo" class="action-button prozis-button">
                {{ showProzisInfo ? 'Masquer les informations' : 'Prozis √âlite' }}
            </button>
            <div v-if="showProzisInfo" class="prozis-info-box">
                <p>Informations du partenaire :</p>
                <ul>
                    <li><strong>ID :</strong> {{ prozisInfo.id }}</li>
                    <li><strong>MDP :</strong> {{ prozisInfo.password }}</li>
                    <li><strong>Coupon :</strong> {{ prozisInfo.coupon }}</li>
                </ul>
            </div>
        </fieldset>
        <footer id="main-footer">
    ¬© G/ Maheux
</footer>
        </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <script>
        let siteConfig;

        document.addEventListener('DOMContentLoaded', async () => {
            // --- Theme & Dock Logic (independent of config) ---
            const body = document.body;
            const toggleButton = document.getElementById('darkModeToggle');
            const toggleIcon = document.getElementById('darkModeIcon');
            const dockMenu = document.getElementById('dockMenu');
            const dockToggleBtn = document.getElementById('dockToggleBtn');

            function setInitialTheme() {
                const savedTheme = localStorage.getItem('darkMode');
                if (savedTheme === 'true' || (savedTheme === null && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                    body.classList.add('dark-mode');
                    toggleIcon.textContent = 'nightlight';
                } else {
                    body.classList.add('light-mode');
                    toggleIcon.textContent = 'clear_day';
                }
            }
            toggleButton.addEventListener('click', () => {
                body.classList.toggle('dark-mode');
                body.classList.toggle('light-mode');
                const isDarkMode = body.classList.contains('dark-mode');
                localStorage.setItem('darkMode', isDarkMode);
                toggleIcon.textContent = isDarkMode ? 'nightlight' : 'clear_day';
            });
            setInitialTheme();

            function toggleDock() {
                dockMenu.classList.toggle('collapsed');
                localStorage.setItem('dockCollapsed', dockMenu.classList.contains('collapsed'));
            }
            if (localStorage.getItem('dockCollapsed') === 'true') {
                dockMenu.classList.add('collapsed');
            }
            dockToggleBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                toggleDock();
            });

            // *** LOGIQUE DE R√âTRACTATION AJOUT√âE ***
            document.addEventListener('click', (e) => {
                if (!dockMenu.contains(e.target) && !dockMenu.classList.contains('collapsed')) {
                    toggleDock();
                }
            });

            // --- Config Loader ---
            try {
                const response = await fetch('all.json');
                if (!response.ok) throw new Error('Network response was not ok.');
                siteConfig = await response.json();
                initializeApp();
            } catch (error) {
                document.body.innerHTML = `<div style="color: white; text-align: center; padding: 50px;"><h1>Erreur de Configuration</h1><p>Le fichier <code>all.json</code> est introuvable ou invalide. Veuillez configurer le site via la page <code>setup.html</code>.</p></div>`;
                console.error("Failed to load all.json:", error);
            }
        });

        function initializeApp() {
            const { createApp } = Vue;

            createApp({
                data() {
                    return {
                        siteTitle: 'Popote', // *** TITRE FIX√â SUR 'POPOTE' ***
                        backendUrl: siteConfig.backendUrl || '',
                        selectedMember: "",
                        password: "",
                        oldPassword: "",
                        newPassword: "",
                        isConnected: false,
                        allDettes: [],
                        allMembers: [],
                        loadingValidation: false,
                        loadingSubmit: false,
                        loadingPasswordChange: false,
                        validationMessage: { text: "", isCorrect: false },
                        passwordChangeMessage: { text: "", isCorrect: false },
                        conso: { canettes: 0, bcaa: 0, cookie: 0, boules: 0, autres: 0 },
                        // NOUVELLES PROPRI√âT√âS POUR PROZIS √âLITE
                        prozisInfo: null,
                        showProzisInfo: false,
                    };
                },
                created() {
                    if (!this.backendUrl) {
                        this.validationMessage = { text: "URL du backend non configur√©e dans all.json.", isCorrect: false };
                        return;
                    }
                    this.fetchDettes();
                    this.fetchMembers();
                    // R√âCUP√âRATION DES INFORMATIONS PROZIS
                    if (siteConfig.popoteConfig && siteConfig.popoteConfig.elitePartner) {
                        this.prozisInfo = siteConfig.popoteConfig.elitePartner;
                    }
                },
                computed: {
                    connectedMemberDette() {
                        return this.allDettes.find(d => d.membre && d.membre.trim() === this.selectedMember.trim()) || null;
                    },
                    totalConso() {
                        return (this.conso.canettes * 0.6) + (this.conso.bcaa * 1.5) + (this.conso.cookie * 1.8) + (this.conso.boules * 1.5) + (this.conso.autres * 0.4);
                    },
                    isHighDebt() {
                        return this.connectedMemberDette && this.connectedMemberDette.dette >= 20;
                    },
                    isAlertDebt() {
                        return this.isHighDebt && this.connectedMemberDette.dette < 30;
                    },
                    isBlockDebt() {
                        return this.connectedMemberDette && this.connectedMemberDette.dette >= 30;
                    }
                },
                methods: {
                    async fetchApi(action, params = {}) {
                        const url = new URL(this.backendUrl);
                        url.searchParams.append('action', action);
                        for (const key in params) {
                            url.searchParams.append(key, params[key]);
                        }
                        const response = await fetch(url);
                        return response.json();
                    },
                    async fetchDettes() {
                        const rawDettes = await this.fetchApi('getDettes');
                        this.allDettes = rawDettes.map(item => {
                            const debtString = String(item.Dette);
                            const debtValue = parseFloat(debtString.replace(',', '.')) || 0;
                            return { membre: item.Membre, dette: debtValue };
                        });
                    },
                    async fetchMembers() {
                        this.allMembers = (await this.fetchApi('getMembers')).map(member => member.trim());
                    },
                    async validateLogin() {
                        if (!this.selectedMember || !this.password) {
                            this.validationMessage = { text: "Veuillez remplir tous les champs.", isCorrect: false };
                            return;
                        }
                        this.loadingValidation = true;
                        const result = await this.fetchApi('authenticate', { member: this.selectedMember, password: this.password });
                        if (result.result === 'success') {
                            this.isConnected = true;
                            this.validationMessage = { text: `Acc√®s autoris√© pour ${this.selectedMember}.`, isCorrect: true };
                            await this.fetchDettes();
                        } else {
                            this.validationMessage = { text: "Mot de passe incorrect.", isCorrect: false };
                        }
                        this.loadingValidation = false;
                    },
                    async submitConso() {
                         if (this.totalConso <= 0) {
                            this.validationMessage = { text: "Veuillez entrer une consommation.", isCorrect: false };
                            return;
                        }
                        this.loadingSubmit = true;
                        const data = { membre: this.selectedMember, ...this.conso };
                        
                        const response = await fetch(this.backendUrl, {
                            method: 'POST',
                            redirect: 'follow',
                            body: JSON.stringify(data),
                            headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                        });
                        const result = await response.json();

                        if (result.result === 'success') {
                            this.validationMessage = { text: `Consommation ajout√©e !`, isCorrect: true };
                            this.resetConsoInputs();
                            await this.fetchDettes();
                        } else {
                            this.validationMessage = { text: "Erreur d'enregistrement.", isCorrect: false };
                        }
                        this.loadingSubmit = false;
                    },
                     async changeUserPassword() {
                        if (!this.oldPassword || !this.newPassword) {
                            this.passwordChangeMessage = { text: "Veuillez remplir tous les champs.", isCorrect: false };
                            return;
                        }
                        this.loadingPasswordChange = true;
                        const result = await this.fetchApi('changePassword', { member: this.selectedMember, oldPassword: this.oldPassword, newPassword: this.newPassword });
                        if (result.result === 'success') {
                            this.passwordChangeMessage = { text: "Mot de passe modifi√© avec succ√®s !", isCorrect: true };
                            this.oldPassword = "";
                            this.newPassword = "";
                        } else {
                            this.passwordChangeMessage = { text: result.message || "Erreur lors du changement.", isCorrect: false };
                        }
                        this.loadingPasswordChange = false;
                    },
                    resetForm() {
                        this.selectedMember = "";
                        this.password = "";
                        this.isConnected = false;
                        this.validationMessage = { text: "", isCorrect: false };
                        this.resetConsoInputs();
                    },
                    resetConsoInputs() {
                        this.conso = { canettes: 0, bcaa: 0, cookie: 0, boules: 0, autres: 0 };
                    },
                    // NOUVELLE M√âTHODE POUR AFFICHER/MASQUER LES INFOS PROZIS
                    toggleProzisInfo() {
                        this.showProzisInfo = !this.showProzisInfo;
                    }
                }
            }).mount('#app');

            document.getElementById('app').style.display = 'block';
        }
    </script>
</body>
</html>

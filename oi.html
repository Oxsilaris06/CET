<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Générateur d'Ordre Initial</title>
    <style>
        :root {
            --bg-body: #121212; --bg-container: #1e1e1e; --bg-interactive: #2a2a2a;
            --text-primary: #e0e0e0; --text-secondary: #95a5a6; --border-color: #444444;
            --accent-blue: #5b9bd5; --accent-hover: #4a7aa5; --danger-red: #dc3545;
        }
        body.light-mode {
            --bg-body: #e9ecef; --bg-container: #ffffff; --bg-interactive: #f8f9fa;
            --text-primary: #212529; --text-secondary: #6c757d; --accent-blue: #0033a0;
            --accent-hover: #00226b; --border-color: #ced4da; --danger-red: #dc3545;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Arial', sans-serif; background-color: var(--bg-body); color: var(--text-primary); line-height: 1.6; padding: 15px; transition: background-color 0.5s, color 0.5s; }
        .container { max-width: 800px; margin: auto; background: var(--bg-container); padding: 20px 30px; border-radius: 8px; border: 1px solid var(--border-color); }
        h1 { text-align: center; font-size: 2.5em; margin-bottom: 30px; color: var(--accent-blue); text-transform: uppercase; letter-spacing: 2px; font-weight: 400; }
        h2 { color: var(--accent-blue); border-bottom: 2px solid var(--accent-blue); padding-bottom: 10px; margin-top: 20px; font-weight: 400; }
        .form-section { margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: var(--text-secondary); }
        input[type="text"], input[type="date"], input[type="time"], textarea, select {
            width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid var(--border-color);
            border-radius: 4px; box-sizing: border-box; font-size: 1em; background-color: var(--bg-interactive); color: var(--text-primary);
        }
        .file-upload { margin-bottom: 15px; }
        .image-preview { max-width: 100%; height: auto; border: 1px solid var(--border-color); margin-top: 10px; display: block; object-fit: contain; }
        button {
            background-color: var(--accent-blue); color: white; padding: 12px 20px; border: none; border-radius: 4px;
            cursor: pointer; font-size: 16px; margin-top: 20px;
        }
        button:hover { background-color: var(--accent-hover); }
        .grid-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Générateur d'Ordre Initial</h1>

    <div class="form-section">
        <h2>1. SITUATION</h2>
        <label for="date_op">Date de l'opération :</label>
        <input type="date" id="date_op">

        <label for="situation_generale">1.1 Générale :</label>
        <textarea id="situation_generale" rows="4" placeholder="Décrivez les faits et l'enquête..."></textarea>
        
        <label for="situation_particuliere">1.2 Particulière :</label>
        <textarea id="situation_particuliere" rows="2" placeholder="Date, heure et lieu de l'interpellation"></textarea>
    </div>

    <div class="form-section">
        <h2>1.3 ADVERSAIRE(S)</h2>
        <label for="nom_adversaire">Nom/Prénom :</label>
        <input type="text" id="nom_adversaire" placeholder="Nom/Prénom">
        
        <label for="domicile_adversaire">Domicile et Adresse de repli :</label>
        <input type="text" id="domicile_adversaire" placeholder="Adresse complète et autres lieux connus">

        <label for="date_naissance">Date/Lieu de naissance :</label>
        <input type="text" id="date_naissance" placeholder="JJ/MM/AAAA à Ville">

        <label for="description_adversaire">Description :</label>
        <input type="text" id="description_adversaire" placeholder="Stature / Ethnie / Signes particuliers (cicatrices, tatouages...)">

        <label for="profession_adversaire">Profession :</label>
        <input type="text" id="profession_adversaire" placeholder="Profession de l'adversaire">

        <label for="antecedents_adversaire">Antécédents :</label>
        <textarea id="antecedents_adversaire" rows="2" placeholder="TAJ: / BT:"></textarea>

        <label for="etat_esprit_adversaire">État d'esprit :</label>
        <select id="etat_esprit_adversaire">
            <option value="Serein">Serein</option>
            <option value="Hostile">Hostile</option>
            <option value="Conciliant">Conciliant</option>
            <option value="Sur ses gardes">Sur ses gardes</option>
            <option value="Très méfiant FDO">Très méfiant FDO</option>
            <option value="Cavale probable">Cavale probable</option>
        </select>
        
        <label for="attitude_adversaire">Attitude (Interpellations précédentes) :</label>
        <textarea id="attitude_adversaire" rows="2" placeholder="Réactions lors des précédentes interpellations"></textarea>
        
        <label for="volume_adversaire">Volume (Renfort) :</label>
        <input type="text" id="volume_adversaire" placeholder="Seul/En Groupe/Famille / Bande organisée">

        <label for="substances_adversaire">Substances :</label>
        <input type="text" id="substances_adversaire" placeholder="Alcool/Drogues / Régulier/Occasionnel">

        <label for="vehicules_adversaire">Véhicules :</label>
        <input type="text" id="vehicules_adversaire" placeholder="Immat modèle couleur">

        <label for="armes_adversaire">Armes :</label>
        <input type="text" id="armes_adversaire" placeholder="Armes (si connue) ou RAS">

        <label for="mode_action_me1">Mode d'action : ME1 (+ probable)</label>
        <textarea id="mode_action_me1" rows="1" placeholder="Fuite"></textarea>

        <label for="mode_action_me2">Mode d'action : ME2</label>
        <textarea id="mode_action_me2" rows="1" placeholder="Rébellion"></textarea>
        
        <label for="mode_action_me3">Mode d'action : ME3</label>
        <textarea id="mode_action_me3" rows="1" placeholder="Retranchement"></textarea>


        <label for="photoAdversaire">Ajouter une photo de l'adversaire :</label>
        <input type="file" id="photoAdversaire" accept="image/*">
    </div>

    <div class="form-section">
        <h2>1.4 ENVIRONNEMENT</h2>
        <label for="amies">1.4 Ami(e)s :</label>
        <input type="text" id="amies" placeholder="Équipes en soutien (BR, GIC, PSIG MENTON...)">

        <label for="terrain_info">1.5 Terrain / Environnement :</label>
        <input type="text" id="terrain_info" placeholder="Météo / Relief / Milieu / Média">

        <label for="population">1.6 Population :</label>
        <input type="text" id="population" placeholder="Favorable / Défavorable / Neutre">

        <label for="cadre_juridique">1.7 Cadre juridique :</label>
        <input type="text" id="cadre_juridique" placeholder="Préliminaire / Flag / Mandat d'amener">
    </div>

    <div class="form-section">
        <h2>2. MISSIONS du PSIG</h2>
        <textarea id="missions_psig" rows="4" placeholder="INTERPELLER L'OBJECTIF
SÉCURISER LES LIEUX PENDANT LA PERQUISITION
ESCORTER L'INDIVIDU JUSQU'AU LIEU DE GAV"></textarea>
    </div>

    <div class="form-section">
        <h2>3. EXÉCUTION</h2>
        <label for="date_execution">Date d'exécution :</label>
        <input type="date" id="date_execution">
        
        <label for="heure_execution">Heure d'exécution :</label>
        <input type="time" id="heure_execution" value="06:00">
        
        <label for="type_action">Type d'action :</label>
        <input type="text" id="type_action" placeholder="en force / en souplesse">
    </div>
    
    <div class="form-section">
        <h2>4. ARTICULATION</h2>
        <div class="grid-container">
            <div>
                <h3>ÉQUIPE INDIA (Interpellation)</h3>
                <label for="india_1">India 1 :</label>
                <input type="text" id="india_1" placeholder="Personnel">
                <label for="india_2">India 2 :</label>
                <input type="text" id="india_2" placeholder="Personnel">
                <label for="india_3">India 3 :</label>
                <input type="text" id="india_3" placeholder="Personnel">
                <label for="india_4">India 4 :</label>
                <input type="text" id="india_4" placeholder="Personnel">
                <label for="india_5">India 5 :</label>
                <input type="text" id="india_5" placeholder="Personnel">
            </div>
            <div>
                <h3>ÉQUIPE OSCAR (Observation/Appui)</h3>
                <label for="oscar_1">Oscar 1 :</label>
                <input type="text" id="oscar_1" placeholder="Personnel">
                <label for="oscar_2">Oscar 2 :</label>
                <input type="text" id="oscar_2" placeholder="Personnel">
                <label for="oscar_3">Oscar 3 :</label>
                <input type="text" id="oscar_3" placeholder="Personnel">
                <label for="oscar_4">Oscar 4 :</label>
                <input type="text" id="oscar_4" placeholder="Personnel">
                <label for="oscar_5">Oscar 5 :</label>
                <input type="text" id="oscar_5" placeholder="Personnel">
            </div>
        </div>
        
        <label for="place_chef">Place du Chef :</label>
        <input type="text" id="place_chef" placeholder="En INDIA / Avec élément interpellation...">

        <h3>Photos de l'opération</h3>
        <label for="photoCheminement">Cheminement :</label>
        <input type="file" id="photoCheminement" accept="image/*">
        
        <label for="photoTerrain">Terrain / Environnement :</label>
        <input type="file" id="photoTerrain" accept="image/*">
        
        <label for="photoPorte">Porte / Point d'effraction :</label>
        <input type="file" id="photoPorte" accept="image/*">
    </div>

    <button id="generatePdf">Générer le PDF</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
    document.getElementById('generatePdf').addEventListener('click', async () => {
        const doc = new jspdf.jsPDF();
        let yPos = 20;
        const margin = 15;
        const pageWidth = doc.internal.pageSize.getWidth();
        const pageHeight = doc.internal.pageSize.getHeight();

        // Fonction pour ajouter du texte et gérer les sauts de page
        const addText = (text, x, size, style, bold) => {
            const lines = doc.splitTextToSize(text, pageWidth - margin * 2);
            for (const line of lines) {
                if (yPos > pageHeight - margin) {
                    doc.addPage();
                    yPos = margin;
                }
                doc.setFontSize(size);
                doc.setFont(undefined, bold ? "bold" : "normal");
                doc.text(line, x, yPos);
                yPos += size / 1.5;
            }
        };

        // Ajout du contenu du formulaire
        addText("Ordre Initial", pageWidth / 2, 22, "bold");
        yPos += 20;

        addText("1. SITUATION", margin, 16, "bold");
        yPos += 10;

        addText(`Date de l'opération : ${document.getElementById('date_op').value}`, margin, 12, "normal");
        yPos += 5;
        
        if (document.getElementById('situation_generale').value) {
            addText("1.1 Générale :", margin, 12, "bold");
            addText(document.getElementById('situation_generale').value, margin, 12, "normal");
            yPos += 10;
        }

        if (document.getElementById('situation_particuliere').value) {
            addText("1.2 Particulière :", margin, 12, "bold");
            addText(document.getElementById('situation_particuliere').value, margin, 12, "normal");
            yPos += 10;
        }

        yPos += 10;
        addText("1.3 ADVERSAIRE(S)", margin, 16, "bold");
        yPos += 10;

        const adversaireFields = [
            'nom_adversaire', 'domicile_adversaire', 'date_naissance', 'description_adversaire',
            'profession_adversaire', 'antecedents_adversaire', 'etat_esprit_adversaire',
            'attitude_adversaire', 'volume_adversaire', 'substances_adversaire',
            'vehicules_adversaire', 'armes_adversaire', 'mode_action_me1',
            'mode_action_me2', 'mode_action_me3'
        ];

        for (const fieldId of adversaireFields) {
            const element = document.getElementById(fieldId);
            if (element && element.value) {
                const label = document.querySelector(`label[for="${fieldId}"]`).textContent;
                addText(`${label}: ${element.value}`, margin, 12, "normal");
                yPos += 5;
            }
        }
        
        // Photos
        const photos = {
            'photoAdversaire': 'Photo de l\'adversaire',
            'photoCheminement': 'Cheminement',
            'photoTerrain': 'Terrain / Environnement',
            'photoPorte': 'Porte / Point d\'effraction'
        };

        for (const [id, labelText] of Object.entries(photos)) {
            const input = document.getElementById(id);
            if (input.files.length > 0) {
                const file = input.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    addText(labelText, margin, 12, "bold");
                    doc.addImage(e.target.result, 'JPEG', margin, yPos + 5, pageWidth / 2, (pageWidth / 2) * (file.height / file.width));
                    yPos += (pageWidth / 2) * (file.height / file.width) + 10;
                };
                reader.readAsDataURL(file);
            }
        }
        
        // Missions, exécution et articulation
        const sections = [
            { id: 'missions_psig', title: '2. MISSIONS du PSIG' },
            { id: 'date_execution', title: '3. EXÉCUTION', isMultiField: true, fields: ['date_execution', 'heure_execution', 'type_action'] },
            { id: 'equipe_india', title: '4. ARTICULATION', isMultiField: true, fields: ['equipe_india', 'equipe_oscar', 'place_chef'] },
        ];
        
        for (const section of sections) {
            yPos += 10;
            addText(section.title, margin, 16, "bold");
            yPos += 5;

            if (section.isMultiField) {
                for (const fieldId of section.fields) {
                    const element = document.getElementById(fieldId);
                    if (element && element.value) {
                        const label = document.querySelector(`label[for="${fieldId}"]`).textContent;
                        addText(`${label}: ${element.value}`, margin, 12, "normal");
                        yPos += 5;
                    }
                }
            } else {
                const element = document.getElementById(section.id);
                if (element && element.value) {
                    addText(element.value, margin, 12, "normal");
                    yPos += 10;
                }
            }
        }

        doc.save('ordre_initial.pdf');
    });

</script>

</body>
</html>

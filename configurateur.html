<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configurateur Equipement Tactique</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500&family=Saira+Stencil+One&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-body: #121212; --bg-container: #1e1e1e; --bg-interactive: #2a2a2a;
            --text-primary: #e0e0e0; --text-secondary: #95a5a6; --border-color: #444444;
            --accent-blue: #5b9bd5; --accent-hover: #4a7aa5; --danger-red: #dc3545;
            --collective-accent: #ffc107; --collective-hover: #d19a00;
            --glass-background: rgba(30, 30, 30, 0.1); --glass-border: rgba(68, 68, 68, 0.1);
        }
        body.light-mode {
            --bg-body: #e9ecef; --bg-container: #ffffff; --bg-interactive: #f8f9fa;
            --text-primary: #212529; --text-secondary: #6c757d; --accent-blue: #0033a0;
            --accent-hover: #00226b; --border-color: #ced4da; --danger-red: #dc3545;
            --collective-accent: #ffc107; --collective-hover: #d19a00;
            --glass-background: rgba(255, 255, 255, 0.1); --glass-border: rgba(206, 212, 218, 0.1);
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Oswald', sans-serif; background-color: var(--bg-body); color: var(--text-primary); line-height: 1.6; padding: 15px; transition: background-color 0.5s, color 0.5s; }
        .container { max-width: 1200px; margin: auto; background: var(--bg-container); padding: 20px 30px; border-radius: 8px; border: 1px solid var(--border-color); }
        h1 { text-align: center; font-size: 2.5em; margin-bottom: 30px; color: var(--accent-blue); text-transform: uppercase; letter-spacing: 2px; font-family: 'Saira Stencil One', sans-serif; font-weight: 400; }
        @media (min-width: 601px) {
            h1 { font-size: 3.5em; }
        }
        .main-layout { display: flex; align-items: flex-start; gap: 30px; }
        .config-column { flex: 2; min-width: 0; }
        .sidebar-column { flex: 1; position: sticky; top: 20px; }
        .tab-nav {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 25px;
            border-bottom: none;
            justify-content: center;
        }
        .tab-button {
            padding: 10px 15px;
            cursor: pointer;
            border: 1px solid var(--border-color);
            background-color: var(--bg-interactive);
            font-family: 'Saira Stencil One', sans-serif;
            font-size: 1em;
            color: var(--text-primary);
            border-radius: 6px;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            text-transform: uppercase;
            font-weight: 400;
        }
        .tab-button:hover {
            background-color: var(--bg-container);
            box-shadow: 4px 8px rgba(0,0,0,0.1);
        }
        .tab-button.active {
            color: white;
            background-color: var(--accent-blue);
            border-color: var(--accent-blue);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .tab-panel { display: none; }
        .tab-panel.active { display: block; animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .item-selector-wrapper { margin-bottom: 15px; }
        .item-selector { display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; gap: 15px; }
        label { font-weight: 400; font-size: 1.1em; color: var(--text-secondary); display: flex; align-items: center; gap: 8px; flex-basis: 35%; }
        select { 
            width: 100%; 
            flex-basis: 60%; 
            padding: 10px; 
            border: 1px solid var(--border-color); 
            border-radius: 4px; 
            font-size: 1em; 
            font-family: 'Oswald', sans-serif; 
            background-color: var(--bg-interactive); 
            cursor: pointer; 
            -webkit-appearance: none; 
            appearance: none; 
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="%23212529" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>'); 
            background-repeat: no-repeat; 
            background-position: right 10px center; 
            padding-right: 30px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: var(--text-primary);
        }
        body.dark-mode select {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="%23e0e0e0" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');
        }
        .description-box { font-size: 0.9em; color: var(--text-secondary); background-color: var(--bg-interactive); padding: 8px 12px; margin-top: 8px; border-radius: 4px; border-left: 3px solid var(--accent-blue); width: 100%; min-height: 34px; display: none; transition: opacity 0.3s; }
        .context-container { background-color: var(--bg-interactive); border: 1px solid var(--border-color); padding: 15px; border-radius: 5px; margin-top: 10px; }
        .context-container-header { display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .context-container-header h3 { margin: 0; font-family: 'Saira Stencil One', sans-serif; font-size: 1.2em; font-weight: 400; }
        .context-container-header .toggle-arrow { font-size: 1.5em; transform: rotate(0deg); transition: transform 0.3s ease-in-out; }
        .context-container-header .toggle-arrow.rotated { transform: rotate(180deg); }
        .context-container-content { display: none; overflow: hidden; transition: max-height 0.4s ease-in-out, opacity 0.4s ease-in-out; }
        .context-container-content.visible { display: block; max-height: 1000px; opacity: 1; }
        h4 { margin: 0; font-family: 'Saira Stencil One', sans-serif; font-weight: 400; font-size: 1.1em; }
        #poches-container, #utp-protection-container, #panels-container, #atr-options-container, #mat-v1-options-container, #lot-front-panel-container, #dossier-vl-container, #drone-4k-container { display: none; }
        .toggles-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 10px; justify-items: start; }
        /* styles de configurateur.html appliqu√©s */
        .toggle-item {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            background: var(--bg-container);
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            width: auto;
        }
        .toggle-item .item-name {
            color: var(--text-primary);
            font-size: 1em;
            display: flex;
            align-items: center;
            white-space: nowrap;
            margin-bottom: 8px;
        }
        .star-rating { color: #000; margin-left: 8px; font-size: 0.9em; }
        body.dark-mode .star-rating { color: #e0e0e0; }
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 38px;
            height: 20px;
            flex-shrink: 0;
        }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 20px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--accent-blue); }
        input:checked + .slider:before { transform: translateX(18px); }
        /* Fin des styles de configurateur.html */
        .info-button { background: none; border: none; color: var(--text-secondary); font-size: 1.1em; cursor: pointer; margin-left: auto; padding: 0 5px; flex-shrink: 0; }
        .item-description-popup { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 85%; max-width: 400px; background-color: var(--bg-container); border: 1px solid var(--border-color); border-radius: 5px; padding: 15px; box-shadow: 0 8px 16px rgba(0,0,0,0.2); z-index: 1000; display: none; text-align: left; white-space: pre-wrap; word-wrap: break-word; max-height: 80vh; overflow-y: auto; }
        #recap, #share-container, #recap-collectif { margin-top: 0; margin-bottom: 20px; padding: 20px; background-color: var(--bg-interactive); border-radius: 8px; }
        #recap h2, #share-container h3, #recap-collectif h3 { text-align: center; margin-bottom: 15px; font-family: 'Saira Stencil One', sans-serif; font-weight: 400; }
        #recap { border: 1px solid var(--accent-blue); }
        #recap-collectif { border: 1px solid var(--collective-accent); }
        #share-container { border: 1px solid var(--border-color); }
        #selected-items-list, #collective-items-list { list-style-type: none; padding: 0; }
        #selected-items-list li, #collective-items-list li { margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; padding: 10px; background-color: var(--bg-container); border-radius: 4px; border: 1px solid var(--border-color); }
        #selected-items-list a, #collective-items-list a { color: var(--accent-blue); text-decoration: none; font-weight: 500; }
        #selected-items-list a:hover, #collective-items-list a:hover { text-decoration: underline; }
        .total-price { font-size: 1.8em; font-weight: 500; text-align: right; color: var(--accent-blue); margin-top: 20px; border-top: 2px solid var(--border-color); padding-top: 15px; }
        .total-price.collective { color: var(--collective-accent); }
        #reset-btn { display: block; width: 100%; padding: 12px; margin-top: 15px; font-family: 'Oswald', sans-serif; font-size: 1.2em; font-weight: 500; color: white; background-color: var(--danger-red); border: none; border-radius: 4px; cursor: pointer; }
        #reset-collective-btn { display: block; width: 100%; padding: 12px; margin-top: 15px; font-family: 'Oswald', sans-serif; font-size: 1.2em; font-weight: 500; color: white; background-color: var(--collective-accent); border: none; border-radius: 4px; cursor: pointer; }
        .footer-text { text-align: right; margin-top: 15px; font-size: 0.8em; color: var(--text-secondary); }
        .preset-buttons { display: flex; flex-wrap: wrap; justify-content: center; margin-bottom: 15px; gap: 10px; }
        .preset-button { flex-grow: 1; padding: 10px; background-color: var(--accent-blue); color: white; border: none; border-radius: 4px; cursor: pointer; font-family: 'Oswald', sans-serif; font-size: 1em; min-width: 150px; }
        .preset-button:hover { background-color: var(--accent-hover); }
        #share-url-input { width: 100%; padding: 10px; border: 1px solid var(--border-color); background-color: var(--bg-interactive); color: var(--text-primary); border-radius: 4px; margin: 10px 0; font-size: 0.9em; }
        #copy-url-btn { width: 100%; padding: 10px; background-color: var(--accent-blue); color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 1.1em; }
        #copy-notification { text-align: center; color: #28a745; margin-top: 10px; height: 1em; font-weight: bold; transition: opacity 0.3s; }
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .popup-content {
            background-color: var(--bg-container);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            text-align: center;
            position: relative;
        }
        @media (max-width: 600px) {
            .popup-content {
                padding: 15px;
            }
        }
        .close-popup {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 2.5em;
            cursor: pointer;
            color: var(--text-secondary);
            font-weight: 300;
        }
        .close-popup:hover {
            color: var(--text-primary);
        }
        .popup-checkbox {
            margin-top: 20px;
            font-size: 0.9em;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .floating-cart-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background-color: var(--accent-blue);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            z-index: 100;
            transition: background-color 0.3s;
        }
        .floating-cart-button:hover {
            background-color: var(--accent-hover);
        }
        /* Styles mis √† jour pour le dock */
        .dock-menu {
            position: fixed;
            top: 50%;
            left: 0;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 10px;
            background-color: transparent;
            border-radius: 0 30px 30px 0;
            transition: all 0.3s ease;
            z-index: 2000;
            width: 30px; /* R√©duit de 5% de 66.5px */
            justify-content: center;
            align-items: center;
        }
        .dock-menu:hover {
            opacity: 1;
            background-color: rgba(30, 30, 30, 0.05);
            border: 1px solid rgba(68, 68, 68, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        .dock-menu-item {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--bg-container);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 45px; /* R√©duit de 5% de 47.5px */
            height: 45px; /* R√©duit de 5% de 47.5px */
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            text-decoration: none;
        }
        .dock-menu-item:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 10px rgba(0,0,0,0.2);
        }
        .dark-mode-toggle, .home-button {
            position: static;
            top: auto;
            right: auto;
            left: auto;
        }
        .material-symbols-outlined {
            font-variation-settings:
            'FILL' 0,
            'wght' 200,
            'GRAD' 0,
            'opsz' 24
        }
        @media (max-width: 992px) {
            .main-layout { flex-direction: column; }
            .sidebar-column { position: static; width: 100%; }
        }
        @media (max-width: 600px) {
            .container { padding: 15px; }
            h1 { font-size: 2em; }
            h3, h4, legend { font-size: 1.1em; }
            .tab-button { font-size: 0.9em; padding: 8px; white-space: nowrap; }
            .toggles-container { grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }
            .toggle-item .item-name { font-size: 0.95em; }
            .context-container { padding: 10px; }
            .dock-menu {
                top: 10px;
                left: 10px;
                width: 60px;
            }
            .dock-menu-item {
                width: 40px;
                height: 40px;
                font-size: 20px;
            }
            .floating-cart-button {
                bottom: 10px;
                right: 10px;
                width: 40px;
                height: 40px;
                font-size: 20px;
            }
        }
        /* Styles pour le dock r√©tractable */
        .dock-menu.collapsed {
            width: 32px; /* R√©duit de 5% de 47.5px */
            height: auto;
            align-items: center;
            padding: 1px;
            opacity: 1;
            background-color: rgba(30, 30, 30, 0.05);
            border: 1px solid rgba(68, 68, 68, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 0 50% 50% 0;
        }
        .dock-menu.collapsed:hover {
            background-color: var(--bg-container);
        }
        .dock-menu.collapsed .dock-menu-item,
        .dock-menu.collapsed .home-button,
        .dock-menu.collapsed .dark-mode-toggle {
            display: none;
        }
        .dock-toggle-btn {
            position: static;
            background-color: transparent;
            color: var(--text-primary);
            border: none;
            width: 40px; /* R√©duit de 5% de 47.5px */
            height: 40px; /* R√©duit de 5% de 47.5px */
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .dock-toggle-btn .material-icons {
            font-size: 35px; /* R√©duit de 5% de 47.5px */
            transition: transform 0.3s ease, color 0.3s;
            transform: rotate(180deg);
        }
        .dock-menu.collapsed .dock-toggle-btn {
            display: flex;
            background-color: var(--bg-container);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .dock-menu:not(.collapsed) .dock-toggle-btn {
            display: none;
        }
        .dock-menu.collapsed .dock-toggle-btn .material-icons {
            transform: rotate(0deg);
        }
        .dock-menu:not(.collapsed) {
             width: 63px; /* R√©duit de 5% de 66.5px */
             opacity: 0.5;
             border-radius: 0 30px 30px 0;
        }
        .dock-menu:not(.collapsed):hover {
            opacity: 1;
            background-color: rgba(30, 30, 30, 0.05);
            border: 1px solid rgba(68, 68, 68, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
    </style>
</head>
<body>
    <div class="dock-menu" id="dockMenu">
        <div class="dock-toggle-btn" id="dockToggleBtn">
            <span class="material-icons">arrow_left</span>
        </div>
        <a href="index.html" class="dock-menu-item home-button">
            <span class="material-icons">home</span>
        </a>
        <div class="dock-menu-item dark-mode-toggle" id="darkModeToggle">
            <span class="material-symbols-outlined" id="darkModeIcon"></span>
        </div>
    </div>
    <div id="popup-container" class="popup-overlay">
        <div class="popup-content">
            <div class="popup-header">
                <h2>Bienvenue sur le configurateur</h2>
                <span class="close-popup" onclick="closePopup()">‚Üí</span>
            </div>
            <p>Cette page est un configurateur d'√©quipement tactique. Ce n'est pas un site d'achat. Il vous permet de cr√©er et de g√©rer votre propre √©quipement, qu'il soit individuel ou collectif.</p>
            <div class="popup-checkbox">
                <input type="checkbox" id="do-not-show-again">
                <label for="do-not-show-again">Ne plus afficher ce message</label>
            </div>
        </div>
    </div>
<div class="container">
    <h1>Configurateur Equipement Tactique</h1>
    <div class="main-layout">
        <div class="config-column">
            <div class="tab-nav">
                <button class="tab-button active" data-tab-target="#tab-presets">Presets üéöÔ∏è</button>
                <button class="tab-button" data-tab-target="#tab-essentiels">Essentiels ‚öîÔ∏è</button>
                <button class="tab-button" data-tab-target="#tab-lampes">Lampes üî¶</button>
                <button class="tab-button" data-tab-target="#tab-vetements">V√™tements ü™ñ</button>
                <button class="tab-button" data-tab-target="#tab-tete">T√™te üë§</button>
                <button class="tab-button" data-tab-target="#tab-accessoires">Accessoires üñáÔ∏è</button>
                <button class="tab-button" data-tab-target="#tab-psig">Kit PSIG ü•∑üèª</button>
                <button class="tab-button" data-tab-target="#tab-nr">NR üá´üá∑</button>
                <button class="tab-button" data-tab-target="#tab-civil">En Civil üö∂üèª</button>
                <button class="tab-button" data-tab-target="#tab-eor">EOR üí•</button>
                <button class="tab-button" data-tab-target="#tab-collectif">Collectif ü§ôüèª</button>
                <button class="tab-button" data-tab-target="#tab-patchs">Patchs ‚ô†Ô∏è</button>
            </div>
            <div class="tab-content">
                <div id="tab-presets" class="tab-panel active">
                     <div class="preset-buttons">
                         <button class="preset-button" data-preset="psig">Config PSIG ü•∑üèª</button>
                         <button class="preset-button" data-preset="bt">Config BT üëÆüèª‚Äç‚ôÇÔ∏è</button>
                         <button class="preset-button" data-preset="premium">Config Premium üíé</button>
                         <button class="preset-button" data-preset="essentielle">Config Essentielle ‚úîÔ∏è</button>
                     </div>
                </div>
                <div id="tab-essentiels" class="tab-panel">
                    <div class="item-selector-wrapper"><div class="item-selector"><label for="systeme-ceinture">Ceinturon</label><select id="systeme-ceinture"></select></div><div class="description-box" id="systeme-ceinture-desc"></div></div>
                    <div class="item-selector-wrapper"><div class="item-selector"><label for="housse-gpb">GPB / Chest Rig üõ°Ô∏è</label><select id="housse-gpb"></select></div><div class="description-box" id="housse-gpb-desc"></div></div>
                    <div id="atr-options-container" class="context-container">
                        <div class="context-container-header"><h3>Options ATR GEN 2</h3><span class="toggle-arrow">‚ñº</span></div>
                        <div class="context-container-content"><div id="gpb-addons-toggles" class="toggles-container"></div></div>
                    </div>
                    <div id="mat-v1-options-container" class="context-container">
                        <div class="context-container-header"><h3>Options MAT V.1</h3><span class="toggle-arrow">‚ñº</span></div>
                        <div class="context-container-content"><div id="mat-v1-toggles" class="toggles-container"></div></div>
                    </div>
                    <div id="poches-container" class="context-container">
                        <div class="context-container-header"><h3>Ajouter des poches</h3><span class="toggle-arrow">‚ñº</span></div>
                        <div class="context-container-content"><div id="poches-toggles" class="toggles-container"></div></div>
                    </div>
                    <div id="panels-container" class="context-container">
                        <div class="context-container-header"><h3>Panneaux</h3><span class="toggle-arrow">‚ñº</span></div>
                        <div class="context-container-content">
                            <h4>Panneaux Avant</h4><div id="frontPanels-toggles" class="toggles-container"></div>
                            <h4 style="margin-top: 20px;">Panneaux Arri√®re</h4><div id="backPanels-toggles" class="toggles-container"></div>
                        </div>
                    </div>
                </div>
                <div id="tab-lampes" class="tab-panel"><div id="lampes-toggles" class="toggles-container"></div></div>
                <div id="tab-vetements" class="tab-panel">
                    <div class="item-selector-wrapper"><label for="haut">Haut üëï</label><select id="haut"></select><div class="description-box" id="haut-desc"></div></div>
                    <div class="item-selector-wrapper"><label for="bas">Bas üëñ</label><select id="bas"></select><div class="description-box" id="bas-desc"></div></div>
                    <div id="utp-protection-container" class="item-selector-wrapper"><label for="protection-bas">Protection üõ°Ô∏è (Optionnel)</label><select id="protection-bas"></select><div class="description-box" id="protection-bas-desc"></div></div>
                    <div class="item-selector-wrapper"><label for="chaussures">Chaussures ü•æ</label><select id="chaussures"></select><div class="description-box" id="chaussures-desc"></div></div>
                </div>
                <div id="tab-tete" class="tab-panel">
                     <div class="item-selector-wrapper"><label for="casque">Casque üõ°Ô∏è</label><select id="casque"></select><div class="description-box" id="casque-desc"></div></div>
                     <div class="item-selector-wrapper"><label for="headset">Communication üì°</label><select id="headset"></select><div class="description-box" id="headset-desc"></div></div>
                     <div class="item-selector-wrapper"><label for="gants">Gants üß§</label><select id="gants"></select><div class="description-box" id="gants-desc"></div></div>
                     <div class="item-selector-wrapper"><label for="lunettes">Lunettes üï∂Ô∏è</label><select id="lunettes"></select><div class="description-box" id="lunettes-desc"></div></div>
                </div>
                <div id="tab-accessoires" class="tab-panel"><div id="accessoires-toggles" class="toggles-container"></div></div>
                <div id="tab-psig" class="tab-panel">
                     <div class="item-selector-wrapper"><label for="lampeArme">Lampe d'Arme üî¶</label><select id="lampeArme"></select><div class="description-box" id="lampeArme-desc"></div></div>
                     <div class="item-selector-wrapper"><label for="sangle">Sangle üî´</label><select id="sangle"></select><div class="description-box" id="sangle-desc"></div></div>
                     <div id="psig-toggles" class="toggles-container" style="margin-top:20px;"></div>
                </div>
                <div id="tab-nr" class="tab-panel"><div id="garantie-vie-toggles" class="toggles-container"></div></div>
                <div id="tab-civil" class="tab-panel"><div id="en-civil-toggles" class="toggles-container"></div></div>
                <div id="tab-eor" class="tab-panel">
                    <h4>Reco üî≠</h4>
                    <div class="item-selector-wrapper"><div class="item-selector"><label for="telemetre">T√©l√©m√®tre</label><select id="telemetre"></select></div><div class="description-box" id="telemetre-desc"></div></div>
                    <div class="item-selector-wrapper"><div class="item-selector"><label for="drone-4k">Pack DJI Mini 4K</label><select id="drone-4k"></select></div><div class="description-box" id="drone-4k-desc"></div></div>
                    <div id="drone-4k-container" class="context-container">
                        <div class="context-container-header"><h3>Options Drone</h3><span class="toggle-arrow">‚ñº</span></div>
                        <div class="context-container-content"><div id="drone-4k-toggles" class="toggles-container"></div></div>
                    </div>
                    <h4 style="margin-top: 20px;">Marquage ‚ùå</h4>
                    <div id="marquage-toggles" class="toggles-container"></div>
                </div>
                <div id="tab-collectif" class="tab-panel">
                    <h4>V√©hicule üöì</h4>
                    <div class="item-selector-wrapper"><div class="item-selector"><label for="dossier-vl">Dossier VL</label><select id="dossier-vl" data-collective="true"></select></div><div class="description-box" id="dossier-vl-desc"></div></div>
                    <div id="dossier-vl-container" class="context-container">
                        <div class="context-container-header"><h3>Options Dossier VL</h3><span class="toggle-arrow">‚ñº</span></div>
                        <div class="context-container-content"><div id="dossier-vl-toggles" class="toggles-container"></div></div>
                    </div>
                    <h4 style="margin-top: 20px;">√âquipement collectif ü§ù</h4>
                    <div class="item-selector-wrapper"><div class="item-selector"><label for="lot-front-panel">Lot Front Panel</label><select id="lot-front-panel" data-collective="true"></select></div><div class="description-box" id="lot-front-panel-desc"></div></div>
                    <div id="lot-front-panel-container" class="context-container">
                        <div class="context-container-header"><h3>Options Lot Front Panel</h3><span class="toggle-arrow">‚ñº</span></div>
                        <div class="context-container-content"><div id="lot-front-panel-toggles" class="toggles-container"></div></div>
                    </div>
                </div>
                <div id="tab-patchs" class="tab-panel"><div id="patchs-toggles" class="toggles-container"></div></div>
            </div>
        </div>
        <div class="sidebar-column">
            <div id="recap">
                <h2>Panier √©quipement individuel</h2> 
                <ul id="selected-items-list"><li>S√©lectionnez des √©l√©ments...</li></ul>
                <div class="total-price">Prix Total : <span id="total-price">0.00 ‚Ç¨</span></div>
                <button id="reset-btn">R√©initialiser la configuration</button>
            </div>
            <div id="recap-collectif">
                <h3>Panier Collectif ü§ù</h3>
                <ul id="collective-items-list"><li>Aucun article collectif s√©lectionn√©.</li></ul>
                <div class="total-price collective">Prix Total Collectif : <span id="collective-total-price">0.00 ‚Ç¨</span></div>
                <button id="reset-collective-btn">R√©initialiser le panier collectif</button>
            </div>
            <div id="share-container">
                <h3>Partager votre configuration üîó</h3>
                <p>Copiez ce lien unique pour sauvegarder et partager votre √©quipement actuel.</p>
                <input type="text" id="share-url-input" readonly>
                <button id="copy-url-btn">Copier le lien</button>
                <div id="copy-notification"></div>
            </div>
        </div>
    </div>
    <div class="footer-text">Realisation : G/ MAHEUX - PSIG GILETTE</div>
</div>
<div class="floating-cart-button" onclick="document.getElementById('recap').scrollIntoView({ behavior: 'smooth' });">üõí</div>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const body = document.body;
        const toggleButton = document.getElementById('darkModeToggle');
        const toggleIcon = document.getElementById('darkModeIcon');
        function setInitialTheme() {
            const savedTheme = localStorage.getItem('darkMode');
            if (savedTheme === 'true') {
                body.classList.add('dark-mode');
                toggleIcon.textContent = 'nightlight';
            } else if (savedTheme === 'false') {
                body.classList.add('light-mode');
                toggleIcon.textContent = 'clear_day';
            } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                body.classList.add('dark-mode');
                toggleIcon.textContent = 'nightlight';
            } else {
                body.classList.add('light-mode');
                toggleIcon.textContent = 'clear_day';
            }
        }
        function toggleDarkMode() {
            if (body.classList.contains('dark-mode')) {
                body.classList.remove('dark-mode');
                body.classList.add('light-mode');
                toggleIcon.textContent = 'clear_day';
                localStorage.setItem('darkMode', 'false');
            } else {
                body.classList.remove('light-mode');
                body.classList.add('dark-mode');
                toggleIcon.textContent = 'nightlight';
                localStorage.setItem('darkMode', 'true');
            }
        }
        toggleButton.addEventListener('click', toggleDarkMode);
        setInitialTheme();
    
        const dockMenu = document.getElementById('dockMenu');
        const dockToggleBtn = document.getElementById('dockToggleBtn');
    
        function toggleDock() {
            dockMenu.classList.toggle('collapsed');
            const isCollapsed = dockMenu.classList.contains('collapsed');
            localStorage.setItem('dockCollapsed', isCollapsed);
        }
    
        const savedDockState = localStorage.getItem('dockCollapsed');
        if (savedDockState === 'true') {
            dockMenu.classList.add('collapsed');
        }
    
        dockToggleBtn.addEventListener('click', (e) => {
            e.stopPropagation(); // Emp√™che l'√©v√©nement de se propager au document
            toggleDock();
        });

        // Ferme le dock si on clique en dehors
        document.addEventListener('click', (e) => {
            if (!dockMenu.contains(e.target) && !dockMenu.classList.contains('collapsed')) {
                toggleDock();
            }
        });
    
    });
    
    const popupContainer = document.getElementById('popup-container');
    const doNotShowAgainCheckbox = document.getElementById('do-not-show-again');
    function closePopup() {
        popupContainer.style.display = 'none';
        if (doNotShowAgainCheckbox.checked) {
            localStorage.setItem('showPopup', 'false');
        }
    }
    
    document.addEventListener('DOMContentLoaded', () => {
        const showPopup = localStorage.getItem('showPopup');
        if (showPopup !== 'false') {
            popupContainer.style.display = 'flex';
        } else {
            popupContainer.style.display = 'none';
        }
        const database = {
            "systeme-ceinture": [ { id: 1, name: "Agilite Magnetix", note: 3, price: 209.90, link: "https://khimaira-st.com/products/ceinturon-magnetix?variant=50099444023640", description: "Ceinturon premium avec boucle magn√©tique pour une mise en place rapide." }, { id: 2, name: "Ceinturon molle PP", note: 2, price: 29.50, link: "https://a.aliexpress.com/_EzZ4aQo", description: "Plus rigide que le ceinturon tissu, bon rapport qualit√©-prix." }, { id: 3, name: "Ceinturon molle tissu", note: 1, price: 25.00, link: "https://a.aliexpress.com/_EzZ4aQo", description: "Simple, efficace et √©conomique." }, { id: 0, name: "Aucun", price: 0, link: "#", description: "" }, { id: 4, name: "Sous-ceinture", price: 12.00, link: "https://a.aliexpress.com/_EQdMdnW", description: "Sous-ceinture velcro pour stabiliser le ceinturon principal." } ],
            "housse-gpb": [ { id: 5, name: "ATR GEN 2", note: 4, price: 349.90, link: "https://www.rhinogearsolutions.com/page-d-articles/atr-plate-carrier-gen-2", description: "Porte plaque premium, hyper modulaire, prendre MIHD pour mettre sur gpb de dotation" }, { id: 1, name: "MAT V.1", note: 3, price: 199.90, link: "https://labrigadedelequipement.fr/products/mat-v1", description: "Meilleur rapport qualit√©-prix, modulaire et robuste." }, { id: 2, name: "Tiger Tailor Polgen Assaut", note: 3, price: 249.00, link: "https://www.tigertailor.com/fr/polgen-policegendarmerie-nationale/379-3848-housse-tactique-polgen-gen3-assaut-pour-inserts-pngn-0000000003797.html", description: "Excellente option haut de gamme, tr√®s cher." }, { id: 3, name: "Condor exo 2", note: 2, price: 84.90, link: "https://vetsecurite.com/gilets-tactiques/6416-gilet-porte-plaque-gen2-exo-noir-condor.html", description: "Passants MOLLE devant et derri√®re, compatible avec plaques lourdes." }, { id: 4, name: "Chest rig mk3", note: 1, price: 45.00, link: "https://a.aliexpress.com/_EHrnErK", description: "L√©ger, polyvalent, √† porter sur un gilet pare-balles discret." }, { id: 0, name: "Aucune", price: 0, link: "#", description: "" } ],
            "gpb-addons": [ { id: 1001, name: "MIHD", price: 20.00, link: "https://www.tactical-equipements.fr/panneaux/9534-module-insert-pour-housse-de-dotation-rgs.html", description: "‚ö†Ô∏è Obligatoire si ATR Gen2" } ],
            "mat-v1-toggles": [ { id: 1002, name: "Cummerbund", price: 45.00, link: "https://labrigadedelequipement.fr/products/cummerbund-flex", description: "Ajoute un Cummerbund pour le MAT V.1" } ],
            "poches": [ { id: 101, name: "Poche Simple 9mm laser cut", note: 1, price: 8.90, link: "https://a.aliexpress.com/_EymNE1m", description: "Porte-chargeur ouvert pour chargeur 9mm." }, { id: 102, name: "Poche Double 9mm rigide", note: 2, price: 13.90, link: "https://a.aliexpress.com/_Ey2qiU4", description: "Double porte-chargeur ouvert pour 9mm avec insert rigide." }, { id: 103, name: "Esstac KYWI Inclin√©", note: 3, price: 42.00, link: "https://khimaira-st.com/products/single-angled-40-pistol-pouch-kywi-magnet?variant=39664872095779", description: "Porte-chargeur pistolet inclin√© √† 40¬∞ et magnetique pour un acc√®s rapide, montage sur ceinture." }, { id: 201, name: "Poche Simple 5.56 laser cut", note: 1, price: 8.50, link: "https://a.aliexpress.com/_ExcTtKk", description: "Poche √©lastique pour chargeur 5.56, COMPATIBLE : MP7/UMP9/GENL/T7" }, { id: 202, name: "Poche Simple 5.56 + 9mm", note: 1, price: 9.20, link: "https://a.aliexpress.com/_EH3sAJi", description: "Poche combin√©e pour ceinturon ou en compl√©ment sur gilet, COMPATIBLE : MP7/UMP9/GENL/T7." }, { id: 203, name: "Poche Triple 5.56 + 9mm", note: 2, price: 26.00, link: "https://a.aliexpress.com/_Exk2WsG", description: "Option tr√®s polyvalente pour emport multiple, COMPATIBLE : MP7/UMP9/GENL/T7." }, { id: 204, name: "Poche Grand format G36", note: 1, price: 9.00, link: "https://a.aliexpress.com/_EvE2pti", description: "Compatible double chargeur 5.56 ou chargeur G36 COMPATIBLE : MP7/G36/UMP9/GENL/TPH700/T7." } ],
            "accessoires": [ { id: 301, name: "Poche de d√©lestage", price: 14.90, link: "https://a.aliexpress.com/_Evxp5hi", description: "Utile sur ceinturon, COMPATIBLE : MP7/UMP9/GENL/T7/G36/DLGC/TPH700..." }, { id: 302, name: "Multi tool", price: 22.50, link: "https://a.aliexpress.com/_EuYqmtq", description: "Outil multifonctions type Leatherman Wave pour le d√©pannage." }, { id: 303, name: "Cale porte WEDGE IT", price: 7.90, link: "https://a.aliexpress.com/_EvmCDcY", description: "Cale-porte en polymere tr√®s r√©sistant et polyvalent." }, { id: 304, name: "Chemlight - Cyalume", price: 1.90, link: "https://a.aliexpress.com/_EuCi0PK", description: "B√¢ton lumineux chimique pour marquage ou √©clairage d'appoint." }, { id: 305, name: "Insert porte garrot", price: 9.90, link: "https://a.aliexpress.com/_Ewh15qc", description: "Se place sous le panneau avant du gilet pour un acc√®s rapide." }, { id: 306, name: "Clips QASM", price: 4.90, link: "https://a.aliexpress.com/_Exn7n8o", description: "Clips pour fixer un panneau avant sur les gilets compatibles (MAT V1 / Tiger Tailor)."}, { id: 307, name: "Porte Cl√© / Gant", price: 4.50, link: "https://a.aliexpress.com/_EvCyjz2", description: "Accessoire pour accrocher cl√©s de menottes, gants, etc."}, { id: 308, name: "Brancard RHINO Evac", price: 37.00, link: "https://military.eu/fr/p/rhino-rescue/brancard-de-secours-multi-use-disposable-litter-sling-rhino-rescue-olive-2803812", description: "Brancard d'√©vacuation souple et tr√®s peu encombrant." } ],
            "frontPanels": [ { id: 501, name: "Front Panel Molle Laser Cut", price: 19.90, link: "https://a.aliexpress.com/_EGMW9K2", description: "Permet de pr√©parer plusieurs configurations de poches interchangeables."}, { id: 502, name: "Front Hanger Pouch", price: 13.50, link: "https://a.aliexpress.com/_EH1Vnkq", description: "Poche 'Hanger' √† fixer sur les gilets avec scratch ventraux (TT / Mat V1)" } ],
            "backPanels": [ { id: 601, name: "Zip Molle pour Back Panel", price: 15.00, link: "https://a.aliexpress.com/_EvMjxc0", description: "Adaptateur indispensable pour fixer un panneau dorsal zipp√©."}, { id: 602, name: "Assaut Back Panel (Tout usages)", price: 25.00, link: "https://a.aliexpress.com/_EIzubHK", description: "Emport pour MP7/G36 + Hydratation + PM"}, { id: 603, name: "Assaut Back Panel 2", price: 16.00, link: "https://a.aliexpress.com/_EysB1u0", description: "Poches multiples"}, { id: 604, name: "Back Panel (Triple 40mm)", price: 25.00, link: "https://a.aliexpress.com/_EwR2q8k", description: "x3 40mm + poche centrale"} ],
            "psig-toggles": [ { id: 2001, name: "Poche TPL", price: 35.00, link: "https://tapir-equipements.com/produit/poche-tpl/", description: "Poche Molle pour TPL" }, { id: 801, name: "√âtui TRB (type dotation)", note: 3, price: 130.00, link: "https://www.trb-holsters.com/produits/holsters/holster-owb/holster-kydex-outsider-lampe-secu-2-rigide-owb/", description: "Attention √† bien choisir le mod√®le compatible avec votre arme de service et votre lampe. Pensez au frein-filet pour les vis."}, { id: 901, name: "Back Panel Effraction PSIG TRB (Opt)", note: 1, price: 80.00, link: "https://www.trb-holsters.com/produits/holsters/holster-owb/etui-kydex-multi-pour-outils-5-11-multipry-exclusivement-noir/", description: "Panneau dorsal sp√©cifique pour l'emport d'outils d'effraction comme le MultiPry."} ],
            "garantie-vie": [ { id: 1, name: "Placard Orion Complet", note: 3, price: 130.00, link: "https://www.northmanresilience.com/product-page/orionfull-insertsbasex3-zip-s%C3%A9parateurcurv", description: "Placard avant complet. Garantie √† vie." }, { id: 2, name: "Insert CURV G36", note: 3, price: 35.00, link: "https://www.northmanresilience.com/product-page/insert-curv-base-g36", description: "Insert CURV. Garantie √† vie." }, { id: 3, name: "IFAK Mini KnR", note: 3, price: 65.00, link: "https://www.northmanresilience.com/product-page/mini-chaos-knr-compact-ifak", description: "Trousse de premiers secours compacte. Garantie √† vie." }, { id: 3001, name: "NR - Pack complet", note: 3, price: 195.00, link: "https://www.northmanresilience.com/product-page/pack-set-up-fdo-complet", description: "Pack hyper complet autonome" } ],
            "patchs": [ { id: 4001, name: "Bandeau premium BV", price: 25.00, link: "https://tapir-equipements.com/produit/bandeau-identification/", description: "Bandeau dorsal a coller sur gilet TT / Mat V1" }, { id: 4002, name: "Rondache EOR", price: 8.00, link: "https://pimpmygear.fr/products/patch-mip-moniteur-d-intervention-professionnelle-lasercut-copie?variant=50949170200909", description: "Patch Rondache EOR" } ],
            "lampes": [ { id: 5003, name: "OLIGHT ULTRA 1", note: 3, price: 189.99, link: "https://amzn.eu/d/77Fihj8", description: "Extr√™mement puissante, alliage super resistant" }, { id: 5004, name: "OLIGHT M3S ", note: 3, price: 169.99, link: "https://amzn.eu/d/3H9gFFL", description: "Tr√®s puissante" }, { id: 5002, name: "OCLIP PRO ", note: 3, price: 39.95, link: "https://amzn.eu/d/05U1d11", description: "R√©glage molette, efficace, type C" }, { id: 5001, name: "Lampe gilet / edc (Eco)", note: 2, price: 9.50, link: "https://a.aliexpress.com/_EI8em4E", description: "Pas cher, efficace, type C" } ],
            "en-civil": [ { id: 6001, name: "Lien textile", note: 3, price: 3.50, link: "https://vetsecurite.com/menottes/44116-menottes-jetables-textiles-3661124116120.html", description: "Moins g√™nant que les menottes de dotation" }, { id: 6002, name: "√âtui port civil", note: 3, price: 60.00, link: "https://www.trb-holsters.com/produits/holsters/holsters-iwb/holster-kydex-insider-pontet-a-languette-iwb/", description: "Bien renseigner son arme, sa lampe, port appendix" } ],
            "haut": [ { id: 0, name: "Aucun", price: 0, link: "#", description: "" }, { id: 1, name: "Polo noir", note: 2, price: 22.90, link: "https://vetsecurite.com/tee-shirts-polos/43840-polo-noir-manches-courtes-gendarmerie-patrol.html", description: "Polo respirant Patrol" }, { id: 2, name: "Polo bleu", note: 2, price: 22.90, link: "https://vetsecurite.com/tee-shirts-polos/5900-polo-respirant-gendarmerie-bleu-patrol.html", description: "Polo respirant Patrol" }, { id: 3, name: "Sweat Helikon Tex", note: 2, price: 49.90, link: "https://military.eu/fr/p/helikon/sweat-a-capuche-urban-tactical-hoodie-lite-helikon-black-98853", description: "Sweat avec velcro, bonne qualit√©" } ],
            "bas": [ { id: 0, name: "Aucun", price: 0, link: "#", description: "" }, { id: 1, name: "Pantalon Helikon UTP", note: 2, price: 77.90, link: "https://military.eu/fr/p/helikon/pantalon-utp-polycotton-rip-stop-helikon-navy-blue-173587", description: "Pantalon tactique avec de nombreuses poches et des emplacements pour inserts de protection." } ],
            "protection-bas": [ { id: 0, name: "Aucune", price: 0, link: "#", description: "" }, { id: 401, name: "Inserts de protection UTP", price: 14.90, link: "https://military.eu/fr/p/helikon/inserts-de-protection-low-profile-protective-pad-inserts-helikon-black-9603", description: "Pads en n√©opr√®ne pour la protection des genoux, compatibles avec le pantalon UTP." } ],
            "chaussures": [ { id: 0, name: "Aucune", price: 0, link: "#", description: "" }, { id: 1, name: "Lowa Zefyr Mk2", note: 3, price: 199.90, link: "https://military.eu/fr/p/lowa/chaussures-zephyr-gtx-mid-mk2-lowa-black-339484", description: "Chaussures premium, l√©g√®res et imperm√©ables (Gore-Tex)." } ],
            "casque": [ { id: 0, name: "Aucun", price: 0, link: "#", description: "" }, { id: 1, name: "Couvre casque G3", note: 1, price: 49.90, link: "https://vetsecurite.com/protections-balistiques/7612-couvre-casque-noir-dimatex-3701370612011.html", description: "Couvre casque noir casque G3." } ],
            "headset": [ { id: 0, name: "Aucun", price: 0, link: "#", description: "" }, { id: 1, name: "Casque anti-bruit actif Walker's Bluetooth", note: 2, price: 188.00, link: "https://amzn.eu/d/jcvnom6", description: "Protection auditive active, amplifie les sons faibles et coupe les d√©tonations. Bluetooth inclus (TOM)." } ],
            "gants": [ { id: 0, name: "Aucun", price: 0, link: "#", description: "" }, { id: 1, name: "Mechanix M-Pact 0.5mm", note: 2, price: 32.90, link: "https://military.eu/fr/p/mechanix-wear/gants-tactique-m-pact-0-5-mm-covert-mechanix-wear-97435", description: "Gants renforc√©s offrant une excellente protection contre les impacts et une tres bonne dext√©rit√©." } ],
            "lunettes": [ { id: 0, name: "Aucune", price: 0, link: "#", description: "" }, { id: 1, name: "Kit Drop Zone Pyrax", note: 2, price: 39.90, link: "https://military.eu/fr/p/pyramex/lunettes-de-protection-venture-gear-drop-zone-pyramex-2210247", description: "Kit de lunettes de protection avec verres interchangeables (transparent, fum√©, orane)." }, { id: 2, name: "Bolle safety", note: 2, price: 7.90, link: "https://military.eu/fr/p/bolle/lunettes-tactique-rush-twilight-bolle-11205", description: "Reference des lunettes de protections, l√©gerement fum√©es." } ],
            "lampeArme": [ { id: 0, name: "Aucune", price: 0, link: "#", description: "" }, { id: 702, name: "Olight PL3-R", note: 3, price: 109.99, link: "https://amzn.eu/d/dBiBDiL", description: "1500lm et rechargeable via c√¢ble magn√©tique."}, { id: 701, name: "Olight VALKYRIE", note: 2, price: 89.95, link: "https://amzn.eu/d/2yGVpPM", description: "800lm et fonctionne avec des piles CR123A."} ],
            "sangle": [ { id: 0, name: "Aucune", price: 0, link: "#", description: "" }, { id: 3, name: "Valkyrie 2 points", note: 3, price: 75.00, link: "https://khimaira-st.com/a/p/products/sangle-fusil-valkyrie", description: "Sangle haute qualit√©. Pensez √† ajouter des boucles HK." }, { id: 4, name: "HILDR 2 points", note: 3, price: 85.00, link: "https://hexatac.com/boutique/sangle-a-fusil-hildr/", description: "Qualit√© sup√©rieure. Pensez √† ajouter des boucles HK." }, { id: 2, name: "One Tigris 2 points", note: 2, price: 22.99, link: "https://amzn.eu/d/hNIVm2J", description: "Meilleur rapport qualit√©-prix, avec syst√®me de r√©glage rapide." }, { id: 1, name: "VIPER Tech 1 point", note: 1, price: 12.90, link: "https://www.airsoft-entrepot.fr/viper-tactical-sangle-pour-passant-molle-bk.html", description: "Se fixe directement sur un passant MOLLE, √† l'arri√®re du gilet." } ],
            "etuiTenue": [ { id: 801, name: "√âtui TRB (type dotation)", note: 3, price: 130.00, link: "https://www.trb-holsters.com/produits/holsters/holster-owb/holster-kydex-outsider-lampe-secu-2-rigide-owb/", description: "Attention √† bien choisir le mod√®le compatible avec votre arme de service et votre lampe. Pensez au frein-filet pour les vis."} ],
            "effraction": [ { id: 901, name: "Back Panel Effraction PSIG TRB (Opt)", note: 1, price: 80.00, link: "https://www.trb-holsters.com/produits/holsters/holster-owb/etui-kydex-multi-pour-outils-5-11-multipry-exclusivement-noir/", description: "Panneau dorsal sp√©cifique pour l'emport d'outils d'effraction comme le MultiPry."} ],
            "telemetre": [ { id: 0, name: "Aucun", price: 0, link: "#", description: "" }, { id: 7001, name: "T√©l√©m√®tre", note: 2, price: 45.00, link: "https://a.aliexpress.com/_ExcG9ee", description: "T√©l√©m√®tre jusqu'√† 1000m, nombreuse options, peu on√©reux"} ],
            "drone-4k": [ { id: 0, name: "Aucun", price: 0, link: "#", description: "" }, { id: 7002, name: "Pack DJI Mini 4K", note: 3, price: 300.00, link: "https://amzn.eu/d/4iNFBA8", description: "Kit drone C0 (sans formation), se connecte au smartphone pour navigation et retour vid√©o, 1 batterie = temps de vol : 25min."} ],
            "drone-4k-toggles": [ { id: 7003, name: "Carte SD", note: 3, price: 30.00, link: "https://amzn.eu/d/g7foZAX", description: "Obligatoire si drone DJI" }, { id: 7004, name: "Pack batteries", note: 3, price: 150.00, link: "https://amzn.eu/d/a9msCES", description: "Pack de charge intelligente de batterie + 2 batterie suppl√©mentaire (sois 75min de vol cumul√© avec la batterie fournie)" }, { id: 7005, name: "Warp Camouflage IR", note: 4, price: 100.00, link: "https://www.tacmat.fr/produit/morsel-ascend-isr-france/", description: "Wrap r√©duisant la signature thermique et visuelle du drone." } ],
            "marquage-toggles": [ { id: 304, name: "Chemlight", price: 1.90, link: "https://a.aliexpress.com/_EuCi0PK", description: "B√¢ton lumineux chimique pour marquage ou √©clairage d'appoint." }, { id: 7006, name: "Cyalumes √©lectrique", note: 2, price: 4.20, link: "https://a.aliexpress.com/_EHWkMe6", description: "Cyalume √©lectrique non rechargeable." }, { id: 7007, name: "Piquet de marquage", note: 2, price: 4.00, link: "https://a.aliexpress.com/_EHoWrY2", description: "Piquet de marquage en alu rouge." } ],
            "dossier-vl": [ { id: 0, name: "Aucun", price: 0, collective: true, description: "" }, { id: 8001, name: "Chassis simple", note: 2, price: 19.00, link: "https://a.aliexpress.com/_EQkLJns", collective: true, description: "Chassis squelette rigide." }, { id: 8002, name: "Chassis triple", note: 1, price: 6.00, link: "https://a.aliexpress.com/_EHNYNeW", collective: true, description: "Chassis simple tissu, nombreuses poches int√©gr√©s." } ],
            "dossier-vl-toggles": [ { id: 8003, name: "Poches VL", note: 1, price: 10.00, link: "https://a.aliexpress.com/_EzeXRpy", collective: true, description: "Nombreuses poches grand format pour organisation du panneau molle" } ],
            "lot-front-panel": [ { id: 0, name: "Aucun", price: 0, collective: true, description: "" }, { id: 9001, name: "Lot Front Panel", note: 2, price: 14.00, link: "https://a.aliexpress.com/_EvmafqO", collective: true, description: "Front panel peu on√©reux, ne pas oublier d'activer les coupons. 9 articles maximum." } ],
            "lot-front-panel-toggles": [ { id: 101, name: "Poche Simple 9mm laser cut", note: 1, price: 8.90, link: "https://a.aliexpress.com/_EymNE1m", collective: true, description: "Porte-chargeur ouvert pour chargeur 9mm." }, { id: 102, name: "Poche Double 9mm rigide", note: 2, price: 13.90, link: "https://a.aliexpress.com/_Ey2qiU4", collective: true, description: "Double porte-chargeur ouvert pour 9mm avec insert rigide." }, { id: 201, name: "Poche Simple 5.56 laser cut", note: 1, price: 8.50, link: "https://a.aliexpress.com/_ExcTtKk", collective: true, description: "Poche √©lastique pour chargeur 5.56, COMPATIBLE : MP7/UMP9/GENL/T7" }, { id: 202, name: "Poche Simple 5.56 + 9mm", note: 1, price: 9.20, link: "https://a.aliexpress.com/_EH3sAJi", collective: true, description: "Poche combin√©e pour ceinturon ou en compl√©ment sur gilet, COMPATIBLE : MP7/UMP9/GENL/T7." }, { id: 203, name: "Poche Triple 5.56 + 9mm", note: 2, price: 26.00, link: "https://a.aliexpress.com/_Exk2WsG", collective: true, description: "Option tr√®s polyvalente pour emport multiple, COMPATIBLE : MP7/UMP9/GENL/T7." }, { id: 204, name: "Poche Grand format G36", note: 1, price: 9.00, link: "https://a.aliexpress.com/_EvE2pti", collective: true, description: "Compatible double chargeur 5.56 ou chargeur G36 COMPATIBLE : MP7/G36/UMP9/GENL/TPH700/T7." } ],
        };
        const presets = {
            psig: { "systeme-ceinture": 2, "housse-gpb": 1, bas: 1, "protection-bas": 401, gants: 1, lampeArme: 702, sangle: 2, "mat-v1-toggles": [1002], frontPanels: [502], backPanels: [601, 602], lampes: [5003, 5001], "psig-toggles": [801, 902], "garantie-vie": [3001], "en-civil": [6001, 6002], patchs: [4001] },
            bt: { "systeme-ceinture": 3, "housse-gpb": 1, poches: [102, 203], accessoires: [302, 305, 307], haut: 2, gants: 1, "mat-v1-toggles": [1002] },
            premium: { "systeme-ceinture": 1, "housse-gpb": 5, bas: 1, "protection-bas": 401, chaussures: 1, casque: 1, headset: 1, gants: 1, lunettes: 1, lampeArme: 702, sangle: 4, "gpb-addons": [1001], poches: [101, 103, 203, 204], frontPanels: [501, 502], backPanels: [601, 602], lampes: [5003, 5002], accessoires: [301, 302, 303, 304, 305, 307, 308], "psig-toggles": [2001, 801, 901, 902], "garantie-vie": [3001], "en-civil": [6001, 6002], patchs: [4001] },
            essentielle: { "systeme-ceinture": 3, "housse-gpb": 4, gants: 1, poches: [102], lampes: [5001], accessoires: [302], "en-civil": [6001] },
        };
        let popup = null;
        function populateSelectors() {
            document.querySelectorAll('select').forEach(s => {
                const categoryItems = database[s.id] || [];
                s.innerHTML = '';
                const aucunItem = categoryItems.find(item => item.id === 0);
                if (aucunItem) {
                    const o = document.createElement('option');
                    o.value = '0';
                    o.textContent = aucunItem.name;
                    s.appendChild(o);
                }
                categoryItems.filter(item => item.id !== 0).forEach(item => {
                    const o = document.createElement('option');
                    o.value = item.id;
                    o.textContent = item.name + (item.note ? `  ${'‚òÖ'.repeat(item.note)}` : '');
                    s.appendChild(o);
                });
                if (s.id in database && database[s.id].some(item => item.collective)) {
                    s.setAttribute('data-collective', 'true');
                } else {
                    s.removeAttribute('data-collective');
                }
            });
        }
        function createToggles(cat, contId) {
            const cont = document.getElementById(contId);
            if (!cont) return;
            const existingToggles = cont.querySelectorAll(`.toggle-item[data-category="${cat}"]`);
            existingToggles.forEach(item => item.remove());
            const itemsToCreate = database[cat]?.filter(item => item.id !== 0) || [];
            itemsToCreate.forEach(item => {
                const div = document.createElement('div');
                div.className = 'toggle-item';
                div.dataset.category = cat;
                if (item.collective) { div.dataset.collective = 'true'; }
                const name = document.createElement('span');
                name.className = 'item-name';
                const nameText = document.createTextNode(item.name);
                name.appendChild(nameText);
                if (item.note) {
                    const star = document.createElement('span');
                    star.className = 'star-rating';
                    star.textContent = '‚òÖ'.repeat(item.note);
                    name.appendChild(star);
                }
                if (item.description) {
                    const info = document.createElement('button');
                    info.className = 'info-button';
                    info.textContent = '‚ìò';
                    info.onclick = (e) => {
                        e.stopPropagation();
                        showDescription(item.description);
                    };
                    name.appendChild(info);
                }
                const toggle = document.createElement('label');
                toggle.className = 'toggle-switch';
                const cb = document.createElement('input');
                cb.type = 'checkbox';
                cb.id = `${cat}-${item.id}`;
                cb.value = item.id;
                const slider = document.createElement('span');
                slider.className = 'slider';
                toggle.appendChild(cb);
                toggle.appendChild(slider);
                div.appendChild(name);
                div.appendChild(toggle);
                cont.appendChild(div);
            });
        }
        function showDescription(description) {
            if (popup) popup.remove();
            if (!description) return;
            popup = document.createElement('div');
            popup.className = 'item-description-popup';
            popup.textContent = description;
            document.body.appendChild(popup);
            popup.style.display = 'block';
        }
        function updateRecap() {
            let totalPrice = 0;
            let collectivePrice = 0;
            const list = document.getElementById('selected-items-list');
            const collectiveList = document.getElementById('collective-items-list');
            list.innerHTML = '';
            collectiveList.innerHTML = '';
            const allSelected = [];
            const allCollectiveSelected = [];
            document.querySelectorAll('select').forEach(s => {
                const id = parseInt(s.value);
                if (!isNaN(id) && id !== 0) {
                    const item = database[s.id]?.find(i => i.id === id);
                    if (item) {
                        if (item.collective) {
                            allCollectiveSelected.push(item);
                        } else {
                            allSelected.push(item);
                        }
                    }
                }
            });
            document.querySelectorAll('input[type="checkbox"]:checked').forEach(cb => {
                const parent = cb.closest('.toggle-item');
                if (parent) {
                    const cat = parent.dataset.category;
                    const isCollective = parent.dataset.collective === 'true';
                    const id = parseInt(cb.value);
                    const item = database[cat]?.find(i => i.id === id);
                    if (item) {
                        if (isCollective) {
                            allCollectiveSelected.push(item);
                        } else {
                            allSelected.push(item);
                        }
                    }
                }
            });
            if (allSelected.length === 0) {
                list.innerHTML = '<li>S√©lectionnez des √©l√©ments...</li>';
            } else {
                allSelected.forEach(item => {
                    totalPrice += item.price;
                    const li = document.createElement('li');
                    const link = (item.link && item.link !== '#') ? `<a href="${item.link}" target="_blank">${item.name}</a>` : item.name;
                    li.innerHTML = `<span>${link}</span> <span class="item-price">${item.price.toFixed(2)} ‚Ç¨</span>`;
                    list.appendChild(li);
                });
            }
            document.getElementById('total-price').textContent = `${totalPrice.toFixed(2)} ‚Ç¨`;
            if (allCollectiveSelected.length === 0) {
                collectiveList.innerHTML = '<li>Aucun article collectif s√©lectionn√©.</li>';
            } else {
                allCollectiveSelected.forEach(item => {
                    collectivePrice += item.price;
                    const li = document.createElement('li');
                    const link = (item.link && item.link !== '#') ? `<a href="${item.link}" target="_blank">${item.name}</a>` : item.name;
                    li.innerHTML = `<span>${link}</span> <span class="item-price">${item.price.toFixed(2)} ‚Ç¨</span>`;
                    collectiveList.appendChild(li);
                });
            }
            document.getElementById('collective-total-price').textContent = `${collectivePrice.toFixed(2)} ‚Ç¨`;
        }
        function handleContextualChanges() {
            const gpbVal = parseInt(document.getElementById('housse-gpb').value);
            const isPlateCarrier = [1, 2, 3, 5].includes(gpbVal);
            const isCeinture = parseInt(document.getElementById('systeme-ceinture').value) > 0;
            const basVal = parseInt(document.getElementById('bas').value);
            const droneVal = parseInt(document.getElementById('drone-4k').value);
            const lotFpVal = parseInt(document.getElementById('lot-front-panel').value);
            const dossierVlVal = parseInt(document.getElementById('dossier-vl').value);
            document.getElementById('atr-options-container').style.display = (gpbVal === 5) ? 'block' : 'none';
            document.getElementById('mat-v1-options-container').style.display = (gpbVal === 1) ? 'block' : 'none';
            document.getElementById('poches-container').style.display = (isPlateCarrier || isCeinture) ? 'block' : 'none';
            document.getElementById('panels-container').style.display = isPlateCarrier ? 'block' : 'none';
            document.getElementById('utp-protection-container').style.display = basVal === 1 ? 'block' : 'none';
            document.getElementById('drone-4k-container').style.display = droneVal === 7002 ? 'block' : 'none';
            document.getElementById('lot-front-panel-container').style.display = lotFpVal === 9001 ? 'block' : 'none';
            document.getElementById('dossier-vl-container').style.display = dossierVlVal !== 0 ? 'block' : 'none';
            document.querySelectorAll('select').forEach(selector => {
                const descBox = document.getElementById(`${selector.id}-desc`);
                if (descBox) {
                    const selectedItem = database[selector.id]?.find(item => item.id === parseInt(selector.value));
                    const desc = selectedItem?.description;
                    descBox.textContent = desc || '';
                    descBox.style.display = desc ? 'block' : 'none';
                }
            });
        }
        function updateUrlParameters() {
            const params = new URLSearchParams();
            document.querySelectorAll('select').forEach(s => {
                const item = database[s.id]?.find(i => i.id === parseInt(s.value));
                if (s.value !== '0' && s.value && !item?.collective) {
                    params.set(s.id, s.value);
                }
            });
            const checkedToggles = {};
            document.querySelectorAll('input[type="checkbox"]:checked').forEach(cb => {
                const parent = cb.closest('.toggle-item');
                const cat = parent?.dataset.category;
                const isCollective = parent?.dataset.collective === 'true';
                if (cat && !isCollective) {
                    if (!checkedToggles[cat]) {
                        checkedToggles[cat] = [];
                    }
                    checkedToggles[cat].push(cb.value);
                }
            });
            for (const cat in checkedToggles) {
                params.set(cat, checkedToggles[cat].join(','));
            }
            const newUrl = `${window.location.pathname}?${params.toString()}`;
            window.history.replaceState({}, '', newUrl);
            document.getElementById('share-url-input').value = window.location.href;
        }
        function applyUrlParameters() {
            const params = new URLSearchParams(window.location.search);
            params.forEach((value, key) => {
                const el = document.getElementById(key);
                if (el && el.tagName === 'SELECT') {
                    el.value = value;
                } else {
                    const ids = value.split(',');
                    ids.forEach(id => {
                        const cb = document.getElementById(`${key}-${id}`);
                        if (cb) {
                            cb.checked = true;
                        }
                    });
                }
            });
        }
        function triggerAllChanges() { handleContextualChanges(); updateRecap(); updateUrlParameters(); }
        function resetAll() { 
            const url = new URL(window.location); 
            url.search = ''; 
            window.history.replaceState({}, '', url); 
            document.querySelectorAll('select:not([data-collective="true"])').forEach(s => s.selectedIndex = 0); 
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                const parent = cb.closest('.toggle-item');
                if (!parent || parent.dataset.collective !== 'true') {
                    cb.checked = false;
                }
            });
            triggerAllChanges(); 
        }
        function resetCollective() {
            document.querySelectorAll('select[data-collective="true"]').forEach(s => {
                s.selectedIndex = 0;
            });
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                const parent = cb.closest('.toggle-item');
                if (parent && parent.dataset.collective === 'true') {
                    cb.checked = false;
                }
            });
            triggerAllChanges();
        }
        function setupTabs() {
            const buttons = document.querySelectorAll('.tab-button'); const panels = document.querySelectorAll('.tab-panel');
            buttons.forEach(button => { button.addEventListener('click', () => { const targetId = button.dataset.tabTarget; buttons.forEach(b => b.classList.remove('active')); button.classList.add('active'); panels.forEach(p => p.classList.toggle('active', '#' + p.id === targetId)); }); });
        }
        function applyPreset(name) {
            resetAll(); 
            const config = presets[name]; 
            if (!config) return;
            for (const cat in config) { 
                const val = config[cat]; 
                const el = document.getElementById(cat); 
                if (el) { 
                    el.value = val; 
                } else if (Array.isArray(val)) { 
                    val.forEach(id => { 
                        const cb = document.getElementById(`${cat}-${id}`); 
                        if (cb) cb.checked = true; 
                    }); 
                } 
            }
            triggerAllChanges();
        }
        function setupCollapsibleContainers() {
            document.querySelectorAll('.context-container-header').forEach(header => {
                header.addEventListener('click', () => {
                    const content = header.nextElementSibling;
                    const arrow = header.querySelector('.toggle-arrow');
                    const isVisible = content.classList.contains('visible');
                    content.classList.toggle('visible', !isVisible);
                    arrow.classList.toggle('rotated', !isVisible);
                });
            });
        }
        const toggleConfigs = {
            'gpb-addons':'gpb-addons-toggles', 'mat-v1-toggles':'mat-v1-toggles', 'poches':'poches-toggles', 'accessoires':'accessoires-toggles', 
            'frontPanels':'frontPanels-toggles', 'backPanels':'backPanels-toggles', 'psig-toggles':'psig-toggles', 
            'garantie-vie':'garantie-vie-toggles', 'patchs':'patchs-toggles', 'lampes':'lampes-toggles', 
            'en-civil':'en-civil-toggles', 'etuiTenue':'psig-toggles', 'effraction':'psig-toggles',
            'drone-4k-toggles':'drone-4k-toggles', 'marquage-toggles':'marquage-toggles',
            'dossier-vl-toggles': 'dossier-vl-toggles', 'lot-front-panel-toggles': 'lot-front-panel-toggles'
        };
        populateSelectors();
        
        // Corrected toggle creation to avoid duplicates
        createToggles('psig-toggles', 'psig-toggles');
        createToggles('mat-v1-toggles', 'mat-v1-toggles');
        for(const [cat, id] of Object.entries(toggleConfigs)) { 
            if(cat !== 'etuiTenue' && cat !== 'effraction' && cat !== 'mat-v1-toggles' && cat !== 'psig-toggles') {
                createToggles(cat, id); 
            }
        }

        setupTabs();
        applyUrlParameters();
        triggerAllChanges();
        setupCollapsibleContainers();
        document.querySelector('.config-column').addEventListener('change', e => {
            const target = e.target;
            if (target.type === 'checkbox' && target.checked) {
                const parentContainer = target.closest('.toggles-container');
                if (!parentContainer) return;
                const parentId = parentContainer.id;
                const currentId = parseInt(target.value);
                const zipMolleId = 601;
                if (parentId === 'backPanels-toggles' && currentId !== zipMolleId) { parentContainer.querySelectorAll('input').forEach(other => { if (other !== target && parseInt(other.value) !== zipMolleId) other.checked = false; }); }
            }
            triggerAllChanges();
        });
        document.getElementById('reset-btn').addEventListener('click', resetAll);
        document.getElementById('reset-collective-btn').addEventListener('click', resetCollective);
        document.querySelectorAll('.preset-button').forEach(b => b.addEventListener('click', e => applyPreset(e.target.dataset.preset)));
        document.getElementById('copy-url-btn').addEventListener('click', () => {
            navigator.clipboard.writeText(document.getElementById('share-url-input').value).then(() => {
                const notif = document.getElementById('copy-notification');
                notif.textContent = 'Copi√© !';
                setTimeout(() => { notif.textContent = ''; }, 2000);
            });
        });
        window.addEventListener('click', (e) => { if (popup && !popup.contains(e.target) && !e.target.classList.contains('info-button')) { popup.remove(); popup = null; } });
    });
</script>
</body>
</html>

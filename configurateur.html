<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configurateur Equipement Tactique</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Oswald:wght@400;500&display=swap');
        :root {
            --bg-body: #e9ecef; --bg-container: #ffffff; --bg-interactive: #f8f9fa;
            --text-primary: #212529; --text-secondary: #6c757d; --accent-blue: #0033a0;
            --accent-hover: #00226b; --border-color: #ced4da; --danger-red: #dc3545;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Oswald', sans-serif; background-color: var(--bg-body); color: var(--text-primary); line-height: 1.6; padding: 15px; }
        .container { max-width: 900px; margin: auto; background: var(--bg-container); padding: 20px 30px; border-radius: 8px; border: 1px solid var(--border-color); }
        h1 { text-align: center; font-size: 2.5em; margin-bottom: 30px; color: var(--accent-blue); text-transform: uppercase; letter-spacing: 2px; }
        .tab-nav { display: flex; flex-wrap: wrap; border-bottom: 2px solid var(--border-color); margin-bottom: 25px; }
        .tab-button { padding: 10px 15px; cursor: pointer; border: none; background-color: transparent; font-family: 'Oswald', sans-serif; font-size: 1.2em; color: var(--text-secondary); border-bottom: 3px solid transparent; transition: all 0.2s ease-in-out; margin-bottom: -2px; }
        .tab-button:hover { color: var(--text-primary); }
        .tab-button.active { color: var(--accent-blue); border-bottom-color: var(--accent-blue); }
        .tab-panel { display: none; }
        .tab-panel.active { display: block; animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .item-selector-wrapper { margin-bottom: 15px; }
        .item-selector { display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; gap: 15px; }
        label { font-weight: 400; font-size: 1.1em; color: var(--text-secondary); display: flex; align-items: center; gap: 8px; flex-basis: 35%; }
        select { width: 100%; flex-basis: 60%; padding: 10px; border: 1px solid var(--border-color); border-radius: 4px; font-size: 1em; font-family: 'Oswald', sans-serif; background-color: var(--bg-interactive); cursor: pointer; -webkit-appearance: none; appearance: none; background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="%23212529" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>'); background-repeat: no-repeat; background-position: right 10px center; padding-right: 30px; }
        .description-box { font-size: 0.9em; color: var(--text-secondary); background-color: var(--bg-interactive); padding: 8px 12px; margin-top: 8px; border-radius: 4px; border-left: 3px solid var(--accent-blue); width: 100%; min-height: 34px; display: none; transition: opacity 0.3s; }
        .context-container { background-color: #f8f9fa; border: 1px solid var(--border-color); padding: 15px; border-radius: 5px; margin-top: 10px; }
        #poches-container, #utp-protection-container, #panels-container { display: none; }
        .toggles-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 10px; justify-items: start; }
        .toggle-item { display: inline-flex; flex-direction: column; align-items: center; background: #fff; padding: 10px; border: 1px solid var(--border-color); border-radius: 5px; width: auto; }
        .toggle-item .item-name { color: var(--text-primary); font-size: 1em; display: flex; align-items: center; white-space: nowrap; margin-bottom: 8px; }
        .star-rating { color: #000; margin-left: 8px; font-size: 0.9em; }
        .toggle-switch { position: relative; display: inline-block; width: 38px; height: 20px; flex-shrink: 0; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 20px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 2px; bottom: 2px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--accent-blue); }
        input:checked + .slider:before { transform: translateX(18px); }
        .info-button { background: none; border: none; color: var(--text-secondary); font-size: 1.1em; cursor: pointer; margin-left: auto; padding: 0 5px; flex-shrink: 0; }
        .item-description-popup { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 85%; max-width: 400px; background-color: var(--bg-container); border: 1px solid var(--border-color); border-radius: 5px; padding: 15px; box-shadow: 0 8px 16px rgba(0,0,0,0.2); z-index: 1000; display: none; text-align: left; white-space: pre-wrap; word-wrap: break-word; max-height: 80vh; overflow-y: auto; }
        #recap, #share-container { margin-top: 30px; padding: 20px; background-color: var(--bg-interactive); border-radius: 8px; }
        #recap { border: 1px solid var(--accent-blue); }
        #share-container { border: 1px solid var(--border-color); }
        #recap h2, #share-container h3 { text-align: center; margin-bottom: 15px; }
        #selected-items-list { list-style-type: none; padding: 0; }
        #selected-items-list li { margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; padding: 10px; background-color: var(--bg-container); border-radius: 4px; border: 1px solid var(--border-color); }
        #selected-items-list a { color: var(--accent-blue); text-decoration: none; font-weight: 500; }
        #selected-items-list a:hover { text-decoration: underline; }
        .total-price { font-size: 1.8em; font-weight: 500; text-align: right; color: var(--accent-blue); margin-top: 20px; border-top: 2px solid var(--border-color); padding-top: 15px; }
        #reset-btn { display: block; width: 100%; padding: 12px; margin-top: 15px; font-family: 'Oswald', sans-serif; font-size: 1.2em; font-weight: 500; color: white; background-color: var(--danger-red); border: none; border-radius: 4px; cursor: pointer; }
        .footer-text { text-align: right; margin-top: 15px; font-size: 0.8em; color: var(--text-secondary); }
        .preset-buttons { display: flex; flex-wrap: wrap; justify-content: center; margin-bottom: 15px; gap: 10px; }
        .preset-button { flex-grow: 1; padding: 10px; background-color: var(--accent-blue); color: white; border: none; border-radius: 4px; cursor: pointer; font-family: 'Oswald', sans-serif; font-size: 1em; min-width: 150px; }
        .preset-button:hover { background-color: var(--accent-hover); }
        #share-url-input { width: 100%; padding: 10px; border: 1px solid var(--border-color); background-color: #fff; border-radius: 4px; margin: 10px 0; font-size: 0.9em; }
        #copy-url-btn { width: 100%; padding: 10px; background-color: var(--accent-blue); color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 1.1em; }
        #copy-notification { text-align: center; color: #28a745; margin-top: 10px; height: 1em; font-weight: bold; transition: opacity 0.3s; }

        @media (max-width: 600px) {
            .container { padding: 15px; }
            h1 { font-size: 2em; }
            .tab-button { font-size: 1em; padding: 8px 10px;}
            .toggles-container { grid-template-columns: 1fr; }
            .toggle-item .item-name { font-size: 0.95em; }
            .context-container { padding: 10px; }
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Configurateur Equipement Tactique</h1>
    <div class="tab-nav">
        <button class="tab-button active" data-tab-target="#tab-presets">Presets üéöÔ∏è</button>
        <button class="tab-button" data-tab-target="#tab-essentiels">Essentiels ‚öîÔ∏è</button>
        <button class="tab-button" data-tab-target="#tab-vetements">V√™tements ü™ñ</button>
        <button class="tab-button" data-tab-target="#tab-tete">T√™te üë§</button>
        <button class="tab-button" data-tab-target="#tab-accessoires">Accessoires üñáÔ∏è</button>
        <button class="tab-button" data-tab-target="#tab-psig">Kit PSIG ü•∑üèª</button>
    </div>
    <div class="tab-content">
        <div id="tab-presets" class="tab-panel active">
             <div class="preset-buttons">
                 <button class="preset-button" data-preset="psig">Config PSIG ü•∑üèª</button>
                 <button class="preset-button" data-preset="bt">Config BT üëÆüèª‚Äç‚ôÇÔ∏è</button>
                 <button class="preset-button" data-preset="premium">Config Premium üíé</button>
                 <button class="preset-button" data-preset="essentielle">Config Essentielle ‚úîÔ∏è</button>
             </div>
        </div>
        <div id="tab-essentiels" class="tab-panel">
            <div class="item-selector-wrapper"><div class="item-selector"><label for="systeme-ceinture">Ceinturon</label><select id="systeme-ceinture"></select></div><div class="description-box" id="systeme-ceinture-desc"></div></div>
            <div class="item-selector-wrapper"><div class="item-selector"><label for="housse-gpb">GPB / Chest Rig üõ°Ô∏è</label><select id="housse-gpb"></select></div><div class="description-box" id="housse-gpb-desc"></div></div>
            <div id="poches-container" class="context-container"><h3>Ajouter des poches</h3><div id="poches-toggles" class="toggles-container"></div></div>
            <div id="panels-container" class="context-container">
                <h3>Panneaux Avant</h3><div id="frontPanels-toggles" class="toggles-container"></div>
                <h3 style="margin-top: 20px;">Panneaux Arri√®re</h3><div id="backPanels-toggles" class="toggles-container"></div>
            </div>
        </div>
        <div id="tab-vetements" class="tab-panel">
            <div class="item-selector-wrapper"><label for="haut">Haut üëï</label><select id="haut"></select><div class="description-box" id="haut-desc"></div></div>
            <div class="item-selector-wrapper"><label for="bas">Bas üëñ</label><select id="bas"></select><div class="description-box" id="bas-desc"></div></div>
            <div id="utp-protection-container" class="item-selector-wrapper"><label for="protection-bas">Protection üõ°Ô∏è (Optionnel)</label><select id="protection-bas"></select><div class="description-box" id="protection-bas-desc"></div></div>
            <div class="item-selector-wrapper"><label for="chaussures">Chaussures ü•æ</label><select id="chaussures"></select><div class="description-box" id="chaussures-desc"></div></div>
        </div>
        <div id="tab-tete" class="tab-panel">
             <div class="item-selector-wrapper"><label for="casque">Casque üõ°Ô∏è</label><select id="casque"></select><div class="description-box" id="casque-desc"></div></div>
             <div class="item-selector-wrapper"><label for="headset">Communication üì°</label><select id="headset"></select><div class="description-box" id="headset-desc"></div></div>
             <div class="item-selector-wrapper"><label for="gants">Gants üß§</label><select id="gants"></select><div class="description-box" id="gants-desc"></div></div>
             <div class="item-selector-wrapper"><label for="lunettes">Lunettes üï∂Ô∏è</label><select id="lunettes"></select><div class="description-box" id="lunettes-desc"></div></div>
        </div>
        <div id="tab-accessoires" class="tab-panel"><div id="accessoires-toggles" class="toggles-container"></div></div>
        <div id="tab-psig" class="tab-panel">
             <div class="item-selector-wrapper"><label for="lampeArme">Lampe d'Arme üî¶</label><select id="lampeArme"></select><div class="description-box" id="lampeArme-desc"></div></div>
             <div class="item-selector-wrapper"><label for="etuiTenue">√âtui Port en Tenue üî´</label><select id="etuiTenue"></select><div class="description-box" id="etuiTenue-desc"></div></div>
             <div class="item-selector-wrapper"><label for="sangle">Sangle üî´</label><select id="sangle"></select><div class="description-box" id="sangle-desc"></div></div>
             <div class="item-selector-wrapper"><label for="effraction">Panneau d'Effraction ‚õìÔ∏è‚Äçüí•</label><select id="effraction"></select><div class="description-box" id="effraction-desc"></div></div>
        </div>
    </div>
    <div id="recap">
        <h2>R√©capitulatif & Liens d'achat</h2> 
        <ul id="selected-items-list"><li>S√©lectionnez des √©l√©ments...</li></ul>
        <div class="total-price">Prix Total : <span id="total-price">0.00 ‚Ç¨</span></div>
        <button id="reset-btn">R√©initialiser la configuration</button>
    </div>
    <div id="share-container">
        <h3>Partager votre configuration üîó</h3>
        <p>Copiez ce lien unique pour sauvegarder et partager votre √©quipement actuel.</p>
        <input type="text" id="share-url-input" readonly>
        <button id="copy-url-btn">Copier le lien</button>
        <div id="copy-notification"></div>
    </div>
    <div class="footer-text">Realisation : G/ MAHEUX - PSIG GILETTE</div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const database = {
        "systeme-ceinture": [ { id: 0, name: "Aucun", price: 0, link: "#", description: "" }, { id: 1, name: "Agilite Magnetix", note: 3, price: 209, link: "https://khimaira-st.com/products/ceinturon-magnetix?variant=50099444023640", description: "Ceinturon premium avec boucle magn√©tique pour une mise en place rapide." }, { id: 2, name: "Ceinturon molle PP", note: 2, price: 29, link: "https://a.aliexpress.com/_EzZ4aQo", description: "Plus rigide que le ceinturon tissu, bon rapport qualit√©-prix." }, { id: 3, name: "Ceinturon molle tissu", note: 1, price: 25, link: "https://a.aliexpress.com/_EzZ4aQo", description: "Simple, efficace et √©conomique." }, { id: 4, name: "Sous-ceinture", price: 12, link: "https://a.aliexpress.com/_EQdMdnW", description: "Sous-ceinture velcro pour stabiliser le ceinturon principal." } ],
        "housse-gpb": [ { id: 0, name: "Aucune", price: 0, link: "#", description: "" }, { id: 1, name: "MAT V1 + Cummerbund", note: 3, price: 200, link: "https://labrigadedelequipement.fr/products/mat-v1", description: "Meilleur rapport qualit√©-prix, modulaire et robuste." }, { id: 2, name: "Tiger Tailor Polgen Assaut", note: 3, price: 250, link: "https://www.tigertailor.com/fr/polgen-policegendarmerie-nationale/379-3848-housse-tactique-polgen-gen3-assaut-pour-inserts-pngn-0000000003797.html", description: "Excellente option haut de gamme, tr√®s cher." }, { id: 3, name: "Condor exo 2", note: 2, price: 85, link: "https://vetsecurite.com/gilets-tactiques/6416-gilet-porte-plaque-gen2-exo-noir-condor.html", description: "Passants MOLLE devant et derri√®re, compatible avec plaques lourdes." }, { id: 4, name: "Chest rig mk3", note: 1, price: 45, link: "https://a.aliexpress.com/_EHrnErK", description: "L√©ger, polyvalent, √† porter sur un gilet pare-balles discret." } ],
        "poches": [ { id: 101, name: "Poche Simple 9mm laser cut", note: 1, price: 9, link: "https://a.aliexpress.com/_EymNE1m", description: "Porte-chargeur ouvert pour chargeur 9mm." }, { id: 102, name: "Poche Double 9mm rigide", note: 2, price: 14, link: "https://a.aliexpress.com/_Ey2qiU4", description: "Double porte-chargeur ouvert pour 9mm avec insert rigide." }, { id: 103, name: "Esstac KYWI Inclin√©", note: 3, price: 42, link: "https://khimaira-st.com/products/single-angled-40-pistol-pouch-kywi-magnet?variant=39664872095779", description: "Porte-chargeur pistolet inclin√© √† 40¬∞ et magnetique pour un acc√®s rapide, montage sur ceinture." }, { id: 201, name: "Poche Simple 5.56 laser cut", note: 1, price: 9, link: "https://a.aliexpress.com/_ExcTtKk", description: "Poche √©lastique pour chargeur 5.56, COMPATIBLE : MP7/UMP9/GENL/T7" }, { id: 202, name: "Poche Simple 5.56 + 9mm", note: 1, price: 9, link: "https://a.aliexpress.com/_EH3sAJi", description: "Poche combin√©e pour ceinturon ou en compl√©ment sur gilet, COMPATIBLE : MP7/UMP9/GENL/T7." }, { id: 203, name: "Poche Triple 5.56 + 9mm", note: 2, price: 26, link: "https://a.aliexpress.com/_Exk2WsG", description: "Option tr√®s polyvalente pour emport multiple, COMPATIBLE : MP7/UMP9/GENL/T7." }, { id: 204, name: "Poche Grand format G36", note: 1, price: 9, link: "https://a.aliexpress.com/_EvE2pti", description: "Compatible double chargeur 5.56 ou chargeur G36 COMPATIBLE : MP7/G36/UMP9/GENL/TPH700/T7." } ],
        "accessoires": [ { id: 301, name: "Poche de d√©lestage", price: 15, link: "https://a.aliexpress.com/_Evxp5hi", description: "Utile sur ceinturon, COMPATIBLE : MP7/UMP9/GENL/T7/G36/DLGC/TPH700..." }, { id: 302, name: "Multi tool", price: 22, link: "https://a.aliexpress.com/_EuYqmtq", description: "Outil multifonctions type Leatherman Wave pour le d√©pannage." }, { id: 303, name: "Cale porte WEDGE IT", price: 8, link: "https://a.aliexpress.com/_EvmCDcY", description: "Cale-porte en polymere tr√®s r√©sistant et polyvalent." }, { id: 304, name: "Chemlight - Cyalume", price: 2, link: "https://a.aliexpress.com/_EuCi0PK", description: "B√¢ton lumineux chimique pour marquage ou √©clairage d'appoint." }, { id: 305, name: "Insert porte garrot", price: 10, link: "https://a.aliexpress.com/_Ewh15qc", description: "Se place sous le panneau avant du gilet pour un acc√®s rapide." }, { id: 306, name: "Clips QASM", price: 5, link: "https://a.aliexpress.com/_Exn7n8o", description: "Clips pour fixer un panneau avant sur les gilets compatibles (MAT V1 / Tiger Tailor)."}, { id: 307, name: "Porte Cl√© / Gant", price: 5, link: "https://a.aliexpress.com/_EvCyjz2", description: "Accessoire pour accrocher cl√©s de menottes, gants, etc."}, { id: 308, name: "Brancard RHINO Evac", price: 37, link: "https://military.eu/fr/p/rhino-rescue/brancard-de-secours-multi-use-disposable-litter-sling-rhino-rescue-olive-2803812", description: "Brancard d'√©vacuation souple et tr√®s peu encombrant." } ],
        "frontPanels": [ { id: 501, name: "Front Panel Molle Laser Cut", price: 20, link: "https://a.aliexpress.com/_EGMW9K2", description: "Permet de pr√©parer plusieurs configurations de poches interchangeables."}, { id: 502, name: "Front Hanger Pouch", price: 13, link: "https://a.aliexpress.com/_EH1Vnkq", description: "Poche 'Hanger' √† fixer sur les gilets avec scratch ventraux (TT / Mat V1)" } ],
        "backPanels": [ { id: 601, name: "Zip Molle pour Back Panel", price: 15, link: "https://a.aliexpress.com/_EvMjxc0", description: "Adaptateur indispensable pour fixer un panneau dorsal zipp√©."}, { id: 602, name: "Assaut Back Panel (Tout usages)", price: 25, link: "https://a.aliexpress.com/_EIzubHK", description: "Emport pour MP7/G36 + Hydratation + PM"}, { id: 603, name: "Assaut Back Panel 2", price: 16, link: "https://a.aliexpress.com/_EysB1u0", description: "Poches multiples"}, { id: 604, name: "Back Panel (Triple 40mm)", price: 25, link: "https://a.aliexpress.com/_EwR2q8k", description: "x3 40mm + poche centrale"} ],
        "haut": [ { id: 0, name: "Aucun", price: 0, link: "#", description: "" }, { id: 1, name: "Polo noir", note: 2, price: 23, link: "https://vetsecurite.com/tee-shirts-polos/43840-polo-noir-manches-courtes-gendarmerie-patrol.html", description: "Polo respirant Patrol" }, { id: 2, name: "Polo bleu", note: 2, price: 23, link: "https://vetsecurite.com/tee-shirts-polos/5900-polo-respirant-gendarmerie-bleu-patrol.html", description: "Polo respirant Patrol" }, { id: 3, name: "Sweat Helikon Tex", note: 2, price: 50, link: "https://military.eu/fr/p/helikon/sweat-a-capuche-urban-tactical-hoodie-lite-helikon-black-98853", description: "Sweat avec velcro, bonne qualit√©" } ],
        "bas": [ { id: 0, name: "Aucun", price: 0, link: "#", description: "" }, { id: 1, name: "Pantalon Helikon UTP", note: 2, price: 78, link: "https://military.eu/fr/p/helikon/pantalon-utp-polycotton-rip-stop-helikon-navy-blue-173587", description: "Pantalon tactique avec de nombreuses poches et des emplacements pour inserts de protection." } ],
        "protection-bas": [ { id: 0, name: "Aucune", price: 0, link: "#", description: "" }, { id: 401, name: "Inserts de protection UTP", price: 15, link: "https://military.eu/fr/p/helikon/inserts-de-protection-low-profile-protective-pad-inserts-helikon-black-9603", description: "Pads en n√©opr√®ne pour la protection des genoux, compatibles avec le pantalon UTP." } ],
        "chaussures": [ { id: 0, name: "Aucune", price: 0, link: "#", description: "" }, { id: 1, name: "Lowa Zefyr Mk2", note: 3, price: 199, link: "https://military.eu/fr/p/lowa/chaussures-zephyr-gtx-mid-mk2-lowa-black-339484", description: "Chaussures premium, l√©g√®res et imperm√©ables (Gore-Tex)." } ],
        "casque": [ { id: 0, name: "Aucun", price: 0, link: "#", description: "" }, { id: 1, name: "Couvre casque G3", note: 1, price: 50, link: "https://vetsecurite.com/protections-balistiques/7612-couvre-casque-noir-dimatex-3701370612011.html", description: "Couvre casque noir casque G3." } ],
        "headset": [ { id: 0, name: "Aucun", price: 0, link: "#", description: "" }, { id: 1, name: "Casque anti-bruit actif Walker's Bluetooth", note: 2, price: 188, link: "https://amzn.eu/d/jcvnom6", description: "Protection auditive active, amplifie les sons faibles et coupe les d√©tonations. Bluetooth inclus (TOM)." } ],
        "gants": [ { id: 0, name: "Aucun", price: 0, link: "#", description: "" }, { id: 1, name: "Mechanix M-Pact 0.5mm", note: 2, price: 33, link: "https://military.eu/fr/p/mechanix-wear/gants-tactique-m-pact-0-5-mm-covert-mechanix-wear-97435", description: "Gants renforc√©s offrant une excellente protection contre les impacts et une tres bonne dext√©rit√©." } ],
        "lunettes": [ { id: 0, name: "Aucune", price: 0, link: "#", description: "" }, { id: 1, name: "Kit Drop Zone Pyrax", note: 2, price: 40, link: "https://military.eu/fr/p/pyramex/lunettes-de-protection-venture-gear-drop-zone-pyramex-2210247", description: "Kit de lunettes de protection avec verres interchangeables (transparent, fum√©, orane)." }, { id: 2, name: "Bolle safety", note: 2, price: 8, link: "https://military.eu/fr/p/bolle/lunettes-tactique-rush-twilight-bolle-11205", description: "Reference des lunettes de protections, l√©gerement fum√©es." } ],
        "lampeArme": [ { id: 0, name: "Aucune", price: 0, link: "#", description: "" }, { id: 701, name: "Olight VALKYRIE", note: 2, price: 90, link: "https://amzn.eu/d/2yGVpPM", description: "800lm et fonctionne avec des piles CR123A."}, { id: 702, name: "Olight PL3-R", note: 3, price: 110, link: "https://amzn.eu/d/dBiBDiL", description: "1500lm et rechargeable via c√¢ble magn√©tique."} ],
        "etuiTenue": [ { id: 0, name: "Aucun", price: 0, link: "#", description: "" }, { id: 801, name: "√âtui TRB (type dotation)", note: 3, price: 130, link: "https://www.trb-holsters.com/produits/holsters/holster-owb/holster-kydex-outsider-lampe-secu-2-rigide-owb/", description: "Attention √† bien choisir le mod√®le compatible avec votre arme de service et votre lampe. Pensez au frein-filet pour les vis."} ],
        "sangle": [ { id: 0, name: "Aucune", price: 0, link: "#", description: "" }, { id: 1, name: "VIPER Tech 1 point", note: 1, price: 13, link: "https://www.airsoft-entrepot.fr/viper-tactical-sangle-pour-passant-molle-bk.html", description: "Se fixe directement sur un passant MOLLE, √† l'arri√®re du gilet." }, { id: 2, name: "One Tigris 2 points", note: 2, price: 23, link: "https://amzn.eu/d/hNIVm2J", description: "Meilleur rapport qualit√©-prix, avec syst√®me de r√©glage rapide." }, { id: 3, name: "Valkyrie 2 points", note: 3, price: 75, link: "https://khimaira-st.com/a/p/products/sangle-fusil-valkyrie", description: "Sangle haute qualit√©. Pensez √† ajouter des boucles HK." }, { id: 4, name: "HILDR 2 points", note: 3, price: 85, link: "https://hexatac.com/boutique/sangle-a-fusil-hildr/", description: "Qualit√© sup√©rieure. Pensez √† ajouter des boucles HK." } ],
        "effraction": [ { id: 0, name: "Aucun", price: 0, link: "#", description: "" }, { id: 901, name: "Back Panel Effraction PSIG TRB (Opt)", note: 1, price: 80, link: "https://www.trb-holsters.com/produits/holsters/holster-owb/etui-kydex-multi-pour-outils-5-11-multipry-exclusivement-noir/", description: "Panneau dorsal sp√©cifique pour l'emport d'outils d'effraction comme le MultiPry."} ],
    };
    const presets = {
        psig: { "systeme-ceinture": 2, "housse-gpb": 1, poches: [102, 202], gants: 1, sangle: 2, lampeArme: 701, etuiTenue: 801 },
        bt: { "systeme-ceinture": 3, "housse-gpb": 1, poches: [102, 203], accessoires: [302, 305, 307], haut: 1, gants: 1 },
        premium: { "systeme-ceinture": 1, "housse-gpb": 2, poches: [103, 203, 101], bas: 1, "protection-bas": 401, chaussures: 1, casque: 1, headset: 1, gants: 1, lunettes: 1, lampeArme: 701, etuiTenue: 801, sangle: 2, accessoires: [301, 302, 303, 304, 305, 307] },
        essentielle: { "systeme-ceinture": 3, "housse-gpb": 4, poches: [102], accessoires: [302], gants: 1 },
    };
    
    let popup = null;

    function populateSelectors() {
        document.querySelectorAll('select').forEach(s => { if (database[s.id]) { database[s.id].forEach(item => { const o = document.createElement('option'); o.value = item.id; o.textContent = item.name + (item.note ? `  ${'‚òÖ'.repeat(item.note)}` : ''); s.appendChild(o); }); } });
    }

    function createToggles(cat, contId) {
        const cont = document.getElementById(contId); if (!cont) return;
        cont.innerHTML = '';
        database[cat]?.filter(item => item.id !== 0).forEach(item => {
            const div = document.createElement('div'); div.className = 'toggle-item';
            const name = document.createElement('span'); name.className = 'item-name';
            const nameText = document.createTextNode(item.name);
            name.appendChild(nameText);
            if (item.note) { const star = document.createElement('span'); star.className = 'star-rating'; star.textContent = '‚òÖ'.repeat(item.note); name.appendChild(star); }
            if (item.description) { const info = document.createElement('button'); info.className = 'info-button'; info.textContent = '‚ìò'; info.onclick = (e) => { e.stopPropagation(); showDescription(item.description); }; name.appendChild(info); }
            const toggle = document.createElement('label'); toggle.className = 'toggle-switch';
            const cb = document.createElement('input'); cb.type = 'checkbox'; cb.id = `${cat}-${item.id}`; cb.value = item.id;
            const slider = document.createElement('span'); slider.className = 'slider';
            toggle.appendChild(cb); toggle.appendChild(slider); div.appendChild(name); div.appendChild(toggle); cont.appendChild(div);
        });
    }

    function showDescription(description) {
        if (popup) popup.remove();
        if (!description) return;
        popup = document.createElement('div');
        popup.className = 'item-description-popup';
        popup.textContent = description;
        document.body.appendChild(popup);
        popup.style.display = 'block';
    }

    function updateRecap() {
        let totalPrice = 0; const list = document.getElementById('selected-items-list'); list.innerHTML = ''; const allSelected = [];
        document.querySelectorAll('select').forEach(s => { const id = parseInt(s.value); if (id !== 0) { const item = database[s.id]?.find(i => i.id === id); if (item) allSelected.push({ ...item }); } });
        document.querySelectorAll('input[type="checkbox"]:checked').forEach(cb => { const [cat, id] = cb.id.split(/-(?=\d+$)/); const item = database[cat]?.find(i => i.id === parseInt(id)); if (item) allSelected.push({ ...item }); });
        if (allSelected.length === 0) { list.innerHTML = '<li>S√©lectionnez des √©l√©ments...</li>'; } else {
            allSelected.forEach(item => { totalPrice += item.price; const li = document.createElement('li'); const link = (item.link && item.link !== '#') ? `<a href="${item.link}" target="_blank">${item.name}</a>` : item.name; li.innerHTML = `<span>${link}</span> <span class="item-price">${item.price.toFixed(2)} ‚Ç¨</span>`; list.appendChild(li); });
        }
        document.getElementById('total-price').textContent = `${totalPrice.toFixed(2)} ‚Ç¨`;
    }

    function handleContextualChanges() {
        const gpbVal = parseInt(document.getElementById('housse-gpb').value);
        const isPlateCarrier = [1, 2, 3].includes(gpbVal);
        const isCeinture = parseInt(document.getElementById('systeme-ceinture').value) > 0;
        document.getElementById('poches-container').style.display = (isPlateCarrier || isCeinture) ? 'block' : 'none';
        document.getElementById('panels-container').style.display = isPlateCarrier ? 'block' : 'none';
        document.getElementById('utp-protection-container').style.display = parseInt(document.getElementById('bas').value) === 1 ? 'block' : 'none';
        document.querySelectorAll('select').forEach(selector => {
            const descBox = document.getElementById(`${selector.id}-desc`);
            if(descBox) {
                const selectedItem = database[selector.id]?.find(item => item.id === parseInt(selector.value));
                const desc = selectedItem?.description;
                descBox.textContent = desc || '';
                descBox.style.display = desc ? 'block' : 'none';
            }
        });
    }

    function updateUrlParameters() {
        const params = new URLSearchParams();
        document.querySelectorAll('select').forEach(s => { if (s.value !== '0') { params.set(s.id, s.value); } });
        const checked = {};
        document.querySelectorAll('input[type="checkbox"]:checked').forEach(cb => { const [cat, id] = cb.id.split(/-(?=\d+$)/); if (!checked[cat]) { checked[cat] = []; } checked[cat].push(id); });
        for (const cat in checked) { params.set(cat, checked[cat].join(',')); }
        const newUrl = `${window.location.pathname}?${params.toString()}`;
        window.history.replaceState({}, '', newUrl);
        document.getElementById('share-url-input').value = window.location.href;
    }

    function applyUrlParameters() {
        const params = new URLSearchParams(window.location.search);
        params.forEach((value, key) => {
            const el = document.getElementById(key);
            if (el && el.tagName === 'SELECT') { el.value = value; } else {
                const ids = value.split(',');
                ids.forEach(id => { const cb = document.getElementById(`${key}-${id}`); if (cb) { cb.checked = true; } });
            }
        });
    }

    function triggerAllChanges() { handleContextualChanges(); updateRecap(); updateUrlParameters(); }
    function resetAll() { const url = new URL(window.location); url.search = ''; window.history.replaceState({}, '', url); document.querySelectorAll('select').forEach(s => s.selectedIndex = 0); document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false); triggerAllChanges(); }
    function setupTabs() {
        const buttons = document.querySelectorAll('.tab-button'); const panels = document.querySelectorAll('.tab-panel');
        buttons.forEach(button => { button.addEventListener('click', () => { const targetId = button.dataset.tabTarget; buttons.forEach(b => b.classList.remove('active')); button.classList.add('active'); panels.forEach(p => p.classList.toggle('active', '#' + p.id === targetId)); }); });
    }
    function applyPreset(name) {
        resetAll(); const config = presets[name]; if (!config) return;
        for (const cat in config) { const val = config[cat]; const el = document.getElementById(cat); if (el) { el.value = val; } else if (Array.isArray(val)) { val.forEach(id => { const cb = document.getElementById(`${cat}-${id}`); if (cb) cb.checked = true; }); } }
        triggerAllChanges();
    }

    // --- Initialisation ---
    populateSelectors();
    createToggles('poches', 'poches-toggles');
    createToggles('accessoires', 'accessoires-toggles');
    createToggles('frontPanels', 'frontPanels-toggles');
    createToggles('backPanels', 'backPanels-toggles');
    setupTabs();
    applyUrlParameters();
    triggerAllChanges();

    // --- √âcouteurs d'√©v√©nements ---
    document.querySelector('.container').addEventListener('change', e => {
        const target = e.target;
        if (target.type === 'checkbox' && target.checked) {
            const parentContainer = target.closest('.toggles-container');
            if (!parentContainer) return triggerAllChanges();
            const parentId = parentContainer.id;
            const currentId = parseInt(target.value);
            const zipMolleId = 601;
            if (parentId === 'frontPanels-toggles') { parentContainer.querySelectorAll('input').forEach(other => { if (other !== target) other.checked = false; }); } 
            else if (parentId === 'backPanels-toggles' && currentId !== zipMolleId) { parentContainer.querySelectorAll('input').forEach(other => { if (other !== target && parseInt(other.value) !== zipMolleId) other.checked = false; }); }
        }
        triggerAllChanges();
    });
    document.getElementById('reset-btn').addEventListener('click', resetAll);
    document.querySelectorAll('.preset-button').forEach(b => b.addEventListener('click', e => applyPreset(e.target.dataset.preset)));
    document.getElementById('copy-url-btn').addEventListener('click', () => {
        navigator.clipboard.writeText(document.getElementById('share-url-input').value).then(() => {
            const notif = document.getElementById('copy-notification');
            notif.textContent = 'Copi√© !';
            setTimeout(() => { notif.textContent = ''; }, 2000);
        });
    });
    window.addEventListener('click', (e) => {
        if (popup && !popup.contains(e.target) && !e.target.classList.contains('info-button')) {
            popup.remove();
            popup = null;
        }
    });
});
</script>
</body>
</html>
